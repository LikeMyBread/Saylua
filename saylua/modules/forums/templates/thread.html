{% from "_macros/pagination.html" import pagination %}
{% from "_macros/forms.html" import form_errors %}
{% extends "layout.html" %}
{% set page_title = thread.title %}
{% block header_scripts %}
  <link rel="stylesheet" type="text/css" href="{{ include_static('css/forums.min.css') }}">
{% endblock %}
{% block body %}
<h1>{{ thread.title }}</h1>

<div class="forum-thread-controls">
  <span class="forum-breadcrumb">
    <a href="/forums/">Forums</a> &#187;
    <a href="{{ board.url() }}"> {{ board.title }}</a> &#187;
    {{ truncate(thread.title, 40) }}
  </span>

  <div class="forum-thread-actions">
    <a class="tiny-button" href="#write-forum-reply">
      <img src="/static/img/icons/pencil.png">
      Write a Reply
    </a>
    <a class="tiny-button" href="#">
      <img src="/static/img/icons/bell.png">
      Subscribe
    </a>
  </div>
</div>

<div class="pagination center">
  {{ pagination(page_count=page_count) }}
</div>

<div class="forum-posts-container">
{% for post in posts %}
  <div class="forum-post" id="forum-post-{{ loop.index }}">
    <div class="forum-post-info">
      <a href="{{ post.author.url() }}">{{ post.author.name }}</a>
      <div class="pet-avatar-view">
        <a href="{{ post.author.url() }}" class="avatar-view">
          <img src="{{ post.author.avatar_url() }}" />
        </a>
        {% if post.author.companion %}
        <a href="/pet/{{ post.author.companion.soul_name }}/" class="active-pet-view">
          <img src="{{ post.author.companion.image() }}">
        </a>
        {% endif %}
      </div>
    </div>
    <div class="forum-post-body">
      <div class="forum-post-metadata">
        {{ post.date_created|expanded_relative_time }}
        <span class="forum-post-actions">
          <a href="#forum-post-{{ loop.index }}">Link</a> |
          <a href="#">Quote</a>  |
          <a href="#">Modify</a>
        </span>
      </div>

      {{ post.body|markdown }}
      <div class="divider"></div>
      {{ post.author.name }} hasn't set a signature yet.
    </div>
  </div>
{% endfor %}
</div>

<div class="center">
{{ pagination(page_count=page_count) }}
</div>

<form method="post" class="validated-form" id="write-forum-reply">
<h2>
  <label for="{{ form.body.id }}">Write a New Reply</label>
</h2>
  <table class="form-table">
    <tr>
      <td class="center">
        {{ form.body(placeholder='Type your post content here') }}
        {{ form_errors(form.body) }}
      </td>
    </tr>
    <tr>
      <td class="center">
        <input type="submit" value="Post New Reply" name="post">
        <input type="submit" value="Preview Reply" name="preview">
      </td>
    </tr>
  </table>
  {{ form.csrf_token }}
</form>
{% endblock %}

{% block staff_actions %}
<form method="post" class="center" action="move/">
  <select name="destination" required>
    <option value="" disabled selected>Move Thread To Board</option>
    {% for other_board in other_boards %}
      <option value="{{ other_board.id }}">{{ other_board.title }}</option>
    {% endfor %}
  </select>
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  <button type="submit" class="small" name="move">Move Thread</button>
</form>
{% endblock %}
