{% from "_macros/pagination.html" import pagination %}
{% extends "layout.html" %}
{% set page_title = board.title %}
{% block header_scripts %}
  <link rel="stylesheet" type="text/css" href="{{ include_static('css/forums.min.css') }}">
{% endblock %}
{% block body %}
<h1>Viewing Board: {{ board.title }}</h1>
<span class="forum-breadcrumb">
  <a href="/forums/">Forums</a> &#187; {{ board.title }}
</span>

<a class="write-thread-link" href="#write-thread">
  <img src="/static/img/icons/pencil.png">
  Make a New Thread
</a>

<h2 class="forum-board-header">
  <div class="forum-thread-icon">
    <img src="{{ random_item_image() }}" />
  </div>
  <div class="forum-thread-content">
    <div class="forum-thread-info">
      {{ board.title }}
    </div>
    <div class="forum-thread-replies">
      Replies
    </div>
    <div class="forum-latest-post">
      Latest Post
    </div>
  </div>
</h2>
{% for thread in threads %}
<div class="forum-thread">
  <div class="forum-thread-icon">
    <img src="/static/img/icons/lock.png" />
    {% if thread.is_pinned %}
    <img src="/static/img/icons/pin.png">
    {% endif %}
    {% if thread.is_locked %}
    <img src="/static/img/icons/lock.png">
    {% endif %}
  </div>
  <div class="forum-thread-content">
    <div class="forum-thread-info">
      <a href="/forums/thread/{{ thread.key.id() }}/" class="forum-thread-title">
        {{ thread.title }}
      </a>
      <small>
        Started by <a href="/user/{{ thread.creator_key|name_from_key_string }}">{{ thread.creator_key|name_from_key_string }}</a>
        <span class="line">({{ thread.created_time|relative_time }})</span>
      </small>
    </div>
    <div class="forum-thread-replies">
      {{ thread.key.id()|count_thread_posts - 1 }}
    </div>
    <div class="forum-latest-post">
      {% set last_post = thread.key.id()|last_post_thread %}
      {% if last_post is not none %}
      <img src="{{ random_pet_image() }}" />
      <p>
        by <a href="/user/{{ last_post.creator_key|name_from_key_string }}">
          {{ last_post.creator_key|name_from_key_string }}</a>
        <span class="line">({{ last_post.created_time|relative_time }})</span>
      </p>
      {% endif %}
    </div>
  </div>
</div>
{% endfor %}

<div class="center">
{{ pagination(page_count=page_count) }}
</div>

<h2 class="forum-board-header" id="write-thread">
  <div class="forum-thread-icon">
    <img src="{{ random_item_image() }}" />
  </div>
  Make a New Thread
</h2>
<form method="post" class="validated-form" data-error-id="forum-board-error">
  <table class="form-table">
    <tr>
      <td colspan="2" id="forum-board-error"></td>
    </tr>
    <tr>
      <td class="label"><label for="forum-thread-title">Thread Title</label></td>
      <td>
        <input type="text" placeholder="Thread Title" id="forum-thread-title" name="title"
          data-validators="required not_empty min:3">
      </td>
    </tr>
    <tr>
      <td class="label"><label for="forum-thread-body">Thread Body</label></td>
      <td>
        <textarea placeholder="Thread Content" id="forum-thread-body" name="body"
          data-validators="required not_empty min:2"></textarea>
      </td>
    </tr>
    <tr>
      <td></td>
      <td>
        <input type="submit" value="Post New Thread" name="post">
        <input type="submit" value="Preview Thread" name="preview">
      </td>
    </tr>
  </table>
</form>
{% endblock %}
