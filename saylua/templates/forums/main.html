{% extends "layout.html" %}
{% set page_title = "Forums" %}
{% block body %}
<h2>Forums</h2>
{% for forum_block in forum_blocks %}
<table class="forum-table">
  <tr>
    <th colspan="5" class="section-header">{{ forum_block[0] }}</th>
  </tr>
  <tr>
    <td></td>
    <th>
      Forum
    </th>
    <th>
      Threads
    </th>
    <th>
      Posts
    </th>
    <th>
      Latest Post
    </th>
  </tr>
  {% for board in forum_block[1] %}
  <tr class="forum-board-row">
    <td class="forum-board-icon">
      <img src="/static/img/items/orange.png" class="faded">
    </td>
    <td class="forum-board-info">
      <a href="/forums/board/{{ board.url_title }}/">
        <span class="forum-board-link">{{ board.title }}</span>
        <p>
          {{ board.description }}
        </p>
      </a>
    </td>
    <td>
      {{ board.key.id()|count_board_threads }}
    </td>
    <td>
      {{ board.key.id()|count_board_posts }}
    </td>
    <td class="forum-latest-post">
      {% set last_post = board.key.id()|last_post_board %}
      {% if last_post is not none %}
      <a href="/forums/thread/{{ last_post.thread_id }}">{{ (last_post.thread_id|thread_by_id).title }}
      </a> by <a href="/user/{{ last_post.creator_key|name_from_key_string }}">
        {{ last_post.creator_key|name_from_key_string }}</a>
      on {{ last_post.created_time|show_datetime }}
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% endfor %}
{% endblock %}
