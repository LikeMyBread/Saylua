function init_map(){var e=document.getElementById("dungeon");e.innerHTML="",getMap()}function getMap(){reqwest({url:API_MAP_ENDPOINT,method:"GET",type:"json",success:function(e){var t=e;map.tiles=t.map,renderMap(map),addPlayer(t.player.x,t.player.y)}})}function renderMap(e){var t=document.getElementById("dungeon");t.style.width="640px",t.style.height="512px";for(var a=document.createDocumentFragment(),y=0;y<T_COUNTY;y++)for(var n=0;n<T_COUNTX;n++){var r=document.createElement("div");r.id=n+"_"+y,r.className="dungeonTile",r.style.width="64px",r.style.height="64px",2==e.getTile(n,y)?r.style.backgroundColor="#FF0000":e.getTile(n,y)>0&&(r.style.backgroundColor="#DEB887"),r.addEventListener("click",findPath),r.dataset.x=n,r.dataset.y=y,a.appendChild(r)}t.appendChild(a)}function addPlayer(e,t){var a=document.getElementById("dungeon"),y=document.createElement("div");player={x:0,y:0},y.id="player",y.className="dungeonObject",y.style.width="64px",y.style.height="64px",y.style.backgroundImage="url('/static/img/SHC.png')",y.style.backgroundSize="64px 64px ",a.appendChild(y),movePlayer(e,t)}function movePlayer(e,t){var a=document.getElementById("player"),y=map.getTile(player.x+e,player.y+t);y>0&&reqwest({url:API_MOVE_ENDPOINT,method:"POST",data:player,type:"json",success:function(n){2==y?init_map():(player.x+=e,player.y+=t,a.style.left=player.x*T_WIDTH+"px",a.style.top=player.y*T_WIDTH-PLAYER_OFFSET+"px")}})}function checkKey(e){e=e||window.event,"38"==e.keyCode||"87"==e.keyCode?movePlayer(0,-1):"40"==e.keyCode||"83"==e.keyCode?movePlayer(0,1):"37"==e.keyCode||"65"==e.keyCode?movePlayer(-1,0):"39"!=e.keyCode&&"68"!=e.keyCode||movePlayer(1,0)}function moveHere(){Math.abs(this.dataset.x-player.x)>Math.abs(this.dataset.y-player.y)?this.dataset.x-player.x>0?movePlayer(1,0):movePlayer(-1,0):this.dataset.y-player.y>0?movePlayer(0,1):movePlayer(0,-1)}function findPath(){if(player.x!=this.dataset.x||player.y!=this.dataset.y)for(var e=[{x:this.dataset.x,y:this.dataset.y}],t=[];e.length>0;){var a=e.shift();if(t.push(1*a.x+10*a.y),player.x==a.x-1&&player.y==a.y)return void movePlayer(1,0);if(player.x==1*a.x+1&&player.y==a.y)return void movePlayer(-1,0);if(player.x==1*a.x&&player.y==a.y-1)return void movePlayer(0,1);if(player.x==1*a.x&&player.y==1*a.y+1)return void movePlayer(0,-1);0!=map.getTile(1*a.x-1,1*a.y)&&t.indexOf(1*a.x-1+10*a.y)==-1&&e.push({x:1*a.x-1,y:1*a.y}),0!=map.getTile(1*a.x+1,1*a.y)&&t.indexOf(1*a.x+1+10*a.y)==-1&&e.push({x:1*a.x+1,y:1*a.y}),0!=map.getTile(1*a.x,1*a.y-1)&&t.indexOf(1*a.x+10*(1*a.y-1))==-1&&e.push({x:1*a.x,y:1*a.y-1}),0!=map.getTile(1*a.x,1*a.y+1)&&t.indexOf(1*a.x+10*(1*a.y+1))==-1&&e.push({x:1*a.x,y:1*a.y+1})}}window.addEventListener("load",init_map);const T_WIDTH=64,T_COUNTX=10,T_COUNTY=8,TILE_LOC="/static/img/tiles/",API_MAP_ENDPOINT="/api/explore/map/",API_MOVE_ENDPOINT="/api/explore/move/",PLAYER_OFFSET=0;var map={cols:T_COUNTX,rows:T_COUNTY,tsize:T_WIDTH,tiles:new Array(80),getTile:function(e,t){return e>map.cols-1||t>map.rows-1||t<0||e<0?0:this.tiles[t*map.cols+e]}},player={x:0,y:0};window.addEventListener("keydown",function(e){document.activeElement&&document.activeElement!=document.body||([37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),checkKey())},!1);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR1bmdlb24uanMiXSwibmFtZXMiOlsiaW5pdF9tYXAiLCJkdW5nZW9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImdldE1hcCIsInJlcXdlc3QiLCJ1cmwiLCJBUElfTUFQX0VORFBPSU5UIiwibWV0aG9kIiwidHlwZSIsInN1Y2Nlc3MiLCJyZXNwIiwianNvbkRhdGEiLCJtYXAiLCJ0aWxlcyIsInJlbmRlck1hcCIsImFkZFBsYXllciIsInBsYXllciIsIngiLCJ5Iiwic3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsInRvQWRkIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImkiLCJUX0NPVU5UWSIsImoiLCJUX0NPVU5UWCIsIm5ld0RpdiIsImNyZWF0ZUVsZW1lbnQiLCJpZCIsImNsYXNzTmFtZSIsIlRfV0lEVEgiLCJnZXRUaWxlIiwiYmFja2dyb3VuZENvbG9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbmRQYXRoIiwiZGF0YXNldCIsImFwcGVuZENoaWxkIiwicGxheWVyRGl2IiwiYmFja2dyb3VuZEltYWdlIiwiYmFja2dyb3VuZFNpemUiLCJtb3ZlUGxheWVyIiwidGFyZ2V0IiwiQVBJX01PVkVfRU5EUE9JTlQiLCJkYXRhIiwibGVmdCIsInRvcCIsIlBMQVlFUl9PRkZTRVQiLCJjaGVja0tleSIsImUiLCJ3aW5kb3ciLCJldmVudCIsImtleUNvZGUiLCJtb3ZlSGVyZSIsIk1hdGgiLCJhYnMiLCJ0aGlzIiwicXVldWUiLCJjaGVja2VkIiwibGVuZ3RoIiwiY3VycmVudExvY2F0aW9uIiwic2hpZnQiLCJwdXNoIiwiaW5kZXhPZiIsIlRJTEVfTE9DIiwiY29scyIsInJvd3MiLCJ0c2l6ZSIsIkFycmF5IiwiY29sIiwicm93IiwiYWN0aXZlRWxlbWVudCIsImJvZHkiLCJwcmV2ZW50RGVmYXVsdCJdLCJtYXBwaW5ncyI6IkFBRUEsUUFBU0EsWUFDUCxHQUFJQyxHQUFVQyxTQUFTQyxlQUFlLFVBQ3RDRixHQUFRRyxV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Q3hELEVBRUZiLEtBQUs1QyxNQUFNMEQsRUFBTTNELElBQUlzRCxLQUFPSSxLQUluQ3RELFFBQ0ZDLEVBQUcsRUFDSEMsRUFBRyxFQXVGTGlDLFFBQU9oQixpQkFBaUIsVUFBVyxTQUFTZSxHQUNwQ2xELFNBQVN3RSxlQUFpQnhFLFNBQVN3RSxlQUFpQnhFLFNBQVN5RSxRQUk3RCxHQUFJLEdBQUksR0FBSSxJQUFJVCxRQUFRZCxFQUFFRyxhQUM1QkgsRUFBRXdCLGlCQUdKekIsY0FDRCIsImZpbGUiOiJkdW5nZW9uLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBpbml0X21hcCk7XG5cbmZ1bmN0aW9uIGluaXRfbWFwKCkge1xuICB2YXIgZHVuZ2VvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkdW5nZW9uJyk7XG4gIGR1bmdlb24uaW5uZXJIVE1MID0gXCJcIjtcbiAgZ2V0TWFwKCk7XG59XG5cbmNvbnN0IFRfV0lEVEggPSA2NDtcbmNvbnN0IFRfQ09VTlRYID0gMTA7XG5jb25zdCBUX0NPVU5UWSA9IDg7XG5jb25zdCBUSUxFX0xPQyA9IFwiL3N0YXRpYy9pbWcvdGlsZXMvXCI7XG5jb25zdCBBUElfTUFQX0VORFBPSU5UID0gXCIvYXBpL2V4cGxvcmUvbWFwL1wiO1xuY29uc3QgQVBJX01PVkVfRU5EUE9JTlQgPSBcIi9hcGkvZXhwbG9yZS9tb3ZlL1wiO1xuY29uc3QgUExBWUVSX09GRlNFVCA9IDA7XG5cbnZhciBtYXAgPSB7XG4gIGNvbHM6IFRfQ09VTlRYLFxuICByb3dzOiBUX0NPVU5UWSxcbiAgdHNpemU6IFRfV0lEVEgsXG4gIHRpbGVzOiBuZXcgQXJyYXkoVF9DT1VOVFkgKiBUX0NPVU5UWCksXG4gIGdldFRpbGU6IGZ1bmN0aW9uKGNvbCwgcm93KSB7XG4gICAgaWYgKGNvbCA+IG1hcC5jb2xzIC0gMSB8fCByb3cgPiBtYXAucm93cyAtIDEgfHwgcm93IDwgMCB8fCBjb2wgPCAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudGlsZXNbcm93ICogbWFwLmNvbHMgKyBjb2xdO1xuICB9XG59O1xuXG52YXIgcGxheWVyID0ge1xuICB4OiAwLFxuICB5OiAwXG59O1xuXG5cbmZ1bmN0aW9uIGdldE1hcCgpIHtcbiAgcmVxd2VzdCh7XG4gICAgdXJsOiBBUElfTUFQX0VORFBPSU5ULFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgdHlwZTogJ2pzb24nLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICB2YXIganNvbkRhdGEgPSByZXNwO1xuICAgICAgbWFwLnRpbGVzID0ganNvbkRhdGEubWFwO1xuICAgICAgcmVuZGVyTWFwKG1hcCk7XG4gICAgICBhZGRQbGF5ZXIoanNvbkRhdGEucGxheWVyLngsIGpzb25EYXRhLnBsYXllci55KTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZW5kZXJNYXAobWFwKSB7XG4gIHZhciBkdW5nZW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2R1bmdlb24nKTtcbiAgZHVuZ2Vvbi5zdHlsZS53aWR0aCA9IChUX1dJRFRIICogVF9DT1VOVFgpICsgXCJweFwiO1xuICBkdW5nZW9uLnN0eWxlLmhlaWdodCA9IChUX1dJRFRIICogVF9DT1VOVFkpICsgXCJweFwiO1xuXG4gIHZhciB0b0FkZCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBUX0NPVU5UWTsgaSsrKSB7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBUX0NPVU5UWDsgaisrKSB7XG4gICAgICAgdmFyIG5ld0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgIG5ld0Rpdi5pZCA9IGogKyBcIl9cIiArIGk7XG4gICAgICAgbmV3RGl2LmNsYXNzTmFtZSA9ICdkdW5nZW9uVGlsZSc7XG4gICAgICAgbmV3RGl2LnN0eWxlLndpZHRoID0gVF9XSURUSCArIFwicHhcIjtcbiAgICAgICBuZXdEaXYuc3R5bGUuaGVpZ2h0ID0gVF9XSURUSCArIFwicHhcIjtcbiAgICAgICBpZiAobWFwLmdldFRpbGUoaiwgaSkgPT0gMikge1xuICAgICAgICAgbmV3RGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiI0ZGMDAwMFwiO1xuICAgICAgIH0gZWxzZSBpZiAobWFwLmdldFRpbGUoaiwgaSkgPiAwKSB7XG4gICAgICAgICBuZXdEaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjREVCODg3XCI7XG4gICAgICAgfVxuICAgICAgIG5ld0Rpdi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZmluZFBhdGgpO1xuICAgICAgIG5ld0Rpdi5kYXRhc2V0LnggPSBqO1xuICAgICAgIG5ld0Rpdi5kYXRhc2V0LnkgPSBpO1xuICAgICAgIHRvQWRkLmFwcGVuZENoaWxkKG5ld0Rpdik7XG4gICAgfVxuICB9XG4gIGR1bmdlb24uYXBwZW5kQ2hpbGQodG9BZGQpO1xufVxuXG5mdW5jdGlvbiBhZGRQbGF5ZXIoeCwgeSkge1xuICB2YXIgZHVuZ2VvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkdW5nZW9uJyk7XG4gIHZhciBwbGF5ZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgcGxheWVyID0ge1xuICAgIHg6IDAsXG4gICAgeTogMFxuICB9O1xuICBwbGF5ZXJEaXYuaWQgPSAncGxheWVyJztcbiAgcGxheWVyRGl2LmNsYXNzTmFtZSA9ICdkdW5nZW9uT2JqZWN0JztcbiAgcGxheWVyRGl2LnN0eWxlLndpZHRoID0gVF9XSURUSCArIFwicHhcIjtcbiAgcGxheWVyRGl2LnN0eWxlLmhlaWdodCA9IFRfV0lEVEggKyBcInB4XCI7XG4gIHBsYXllckRpdi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnL3N0YXRpYy9pbWcvU0hDLnBuZycpXCI7XG4gIHBsYXllckRpdi5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9ICBUX1dJRFRIICsgXCJweCBcIiArIFRfV0lEVEggKyBcInB4IFwiO1xuICBkdW5nZW9uLmFwcGVuZENoaWxkKHBsYXllckRpdik7XG4gIG1vdmVQbGF5ZXIoeCwgeSk7XG59XG5cbmZ1bmN0aW9uIG1vdmVQbGF5ZXIoeCwgeSkge1xuICB2YXIgcGxheWVyRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllcicpO1xuICB2YXIgdGFyZ2V0ID0gbWFwLmdldFRpbGUocGxheWVyLnggKyB4LCBwbGF5ZXIueSArIHkpO1xuICBpZiAodGFyZ2V0ID4gMCkge1xuICAgIHJlcXdlc3Qoe1xuICAgICAgdXJsOiBBUElfTU9WRV9FTkRQT0lOVCxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgZGF0YTogcGxheWVyLFxuICAgICAgdHlwZTogJ2pzb24nLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3ApIHtcbiAgICAgICAgaWYgKHRhcmdldCA9PSAyKSB7XG4gICAgICAgICAgLy8gUGxheWVyIGhhcyBmb3VuZCBhbiBleGl0XG4gICAgICAgICAgaW5pdF9tYXAoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwbGF5ZXIueCArPSB4O1xuICAgICAgICAgIHBsYXllci55ICs9IHk7XG4gICAgICAgICAgcGxheWVyRGl2LnN0eWxlLmxlZnQgPSAgKHBsYXllci54ICogVF9XSURUSCkgKyBcInB4XCI7XG4gICAgICAgICAgcGxheWVyRGl2LnN0eWxlLnRvcCA9ICAocGxheWVyLnkgKiBUX1dJRFRIIC0gUExBWUVSX09GRlNFVCkgKyBcInB4XCI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG4vLyBBbGxvdyBwbGF5ZXIgdG8gdXNlIGFycm93IGtleXMgdG8gbW92ZVxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICE9IGRvY3VtZW50LmJvZHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gc3BhY2UgYW5kIGFycm93IGtleXNcbiAgICBpZihbMzcsIDM4LCAzOSwgNDBdLmluZGV4T2YoZS5rZXlDb2RlKSA+IC0xKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgY2hlY2tLZXkoKTtcbn0sIGZhbHNlKTtcblxuZnVuY3Rpb24gY2hlY2tLZXkoZSkge1xuICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcblxuICAgIGlmIChlLmtleUNvZGUgPT0gJzM4JyB8fCBlLmtleUNvZGUgPT0gJzg3Jykge1xuICAgICAgLy8gdXAgYXJyb3dcbiAgICAgIG1vdmVQbGF5ZXIoMCwgLTEpO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09ICc0MCcgfHwgZS5rZXlDb2RlID09ICc4MycpIHtcbiAgICAgIC8vIGRvd24gYXJyb3dcbiAgICAgIG1vdmVQbGF5ZXIoMCwgMSk7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM3JyB8fCBlLmtleUNvZGUgPT0gJzY1Jykge1xuICAgICAgLy8gbGVmdCBhcnJvd1xuICAgICAgbW92ZVBsYXllcigtMSwgMCk7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM5JyB8fCBlLmtleUNvZGUgPT0gJzY4Jykge1xuICAgICAgLy8gcmlnaHQgYXJyb3dcbiAgICAgIG1vdmVQbGF5ZXIoMSwgMCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBtb3ZlSGVyZSAoKSB7XG4gIGlmIChNYXRoLmFicyh0aGlzLmRhdGFzZXQueCAtIHBsYXllci54KSA+ICBNYXRoLmFicyh0aGlzLmRhdGFzZXQueSAtIHBsYXllci55KSkge1xuICAgIGlmICh0aGlzLmRhdGFzZXQueCAtIHBsYXllci54ID4gMCkge1xuICAgICAgbW92ZVBsYXllcigxLCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbW92ZVBsYXllcigtMSwgMCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLmRhdGFzZXQueSAtIHBsYXllci55ID4gMCkge1xuICAgICAgbW92ZVBsYXllcigwLCAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbW92ZVBsYXllcigwLCAtMSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGZpbmRQYXRoKCkge1xuICBpZiAocGxheWVyLnggPT0gdGhpcy5kYXRhc2V0LnggJiYgcGxheWVyLnkgPT0gdGhpcy5kYXRhc2V0LnkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHF1ZXVlID0gW3t4IDogdGhpcy5kYXRhc2V0LngsIHkgOiB0aGlzLmRhdGFzZXQueX1dO1xuICB2YXIgY2hlY2tlZCA9IFtdO1xuICB2YXIgZm91bmQgPSBmYWxzZTtcbiAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICB2YXIgY3VycmVudExvY2F0aW9uID0gcXVldWUuc2hpZnQoKTtcbiAgICBjaGVja2VkLnB1c2goMSAqIGN1cnJlbnRMb2NhdGlvbi54ICsgMTAgKiBjdXJyZW50TG9jYXRpb24ueSk7XG4gICAgaWYgKHBsYXllci54ID09IGN1cnJlbnRMb2NhdGlvbi54IC0gMSAmJiBwbGF5ZXIueSA9PSBjdXJyZW50TG9jYXRpb24ueSkge1xuICAgICAgbW92ZVBsYXllcigxLCAwKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKHBsYXllci54ID09IDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEgJiYgcGxheWVyLnkgPT0gY3VycmVudExvY2F0aW9uLnkpIHtcbiAgICAgIG1vdmVQbGF5ZXIoLTEsIDApO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAocGxheWVyLnggPT0gMSAqIGN1cnJlbnRMb2NhdGlvbi54ICYmIHBsYXllci55ID09IGN1cnJlbnRMb2NhdGlvbi55IC0gMSkge1xuICAgICAgbW92ZVBsYXllcigwLCAxKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKHBsYXllci54ID09IDEgKiBjdXJyZW50TG9jYXRpb24ueCAmJiBwbGF5ZXIueSA9PSAxICogY3VycmVudExvY2F0aW9uLnkgKyAxKSB7XG4gICAgICBtb3ZlUGxheWVyKDAsIC0xKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLnggLSAxLCAxICogY3VycmVudExvY2F0aW9uLnkpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggLSAxICsgMTAgKiBjdXJyZW50TG9jYXRpb24ueSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCAtIDEsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnl9KTtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLnggKyAxLCAxICogY3VycmVudExvY2F0aW9uLnkpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggKyAxICsgMTAgKiBjdXJyZW50TG9jYXRpb24ueSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnl9KTtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLngsIDEgKiBjdXJyZW50TG9jYXRpb24ueSAtIDEpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggKyAxMCAqICgxICogY3VycmVudExvY2F0aW9uLnkgLSAxKSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCwgeSA6IDEgKiBjdXJyZW50TG9jYXRpb24ueSAtIDF9KTtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLngsIDEgKiBjdXJyZW50TG9jYXRpb24ueSArIDEpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggKyAxMCAqICgxICogY3VycmVudExvY2F0aW9uLnkgKyAxKSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCwgeSA6IDEgKiBjdXJyZW50TG9jYXRpb24ueSArIDF9KTtcbiAgICB9XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
