function init(){getMap(),setButton()}function getMap(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var t=JSON.parse(e.responseText);map.tiles=t.map,fillMap(map),addPlayer(t.player.x,t.player.y)}},e.open("GET","api/dungeon",!0),e.send()}function getMask(e,t){var a=0,n=2*(map.getTile(e,t-1)||0),y=8*(map.getTile(e-1,t)||0),l=16*(map.getTile(e+1,t)||0),i=64*(map.getTile(e,t+1)||0);a+=n+y+l+i,n>0&&y>0&&(a+=map.getTile(e-1,t-1)||0),n>0&&l>0&&(a+=4*(map.getTile(e+1,t-1)||0)),i>0&&y>0&&(a+=32*(map.getTile(e-1,t+1)||0)),i>0&&l>0&&(a+=128*(map.getTile(e+1,t+1)||0));var o={2:1,8:2,10:3,11:4,16:5,18:6,22:7,24:8,26:9,27:10,30:11,31:12,64:13,66:14,72:15,74:16,75:17,80:18,82:19,86:20,88:21,90:22,91:23,94:24,95:25,104:26,106:27,107:28,120:29,122:30,123:31,126:32,127:33,208:34,210:35,214:36,216:37,218:38,219:39,222:40,223:41,248:42,250:43,251:44,254:45,255:46,0:47};return o[a+""]}function fillMap(e){dungeon=document.getElementById("dungeon"),dungeon.style.width="640px",dungeon.style.height="512px";for(var t=document.createDocumentFragment(),a=0;a<T_COUNTY;a++)for(var n=0;n<T_COUNTX;n++){var y=document.createElement("div");y.id=n+"_"+a,y.className="dungeonTile",y.style.width="64px",y.style.height="64px",e.getTile(n,a)>0&&(y.style.backgroundImage="url('static/img/tiles/"+getMask(n,a)+".png')"),y.addEventListener("click",findPath),y.dataset.x=n,y.dataset.y=a,t.appendChild(y)}dungeon.appendChild(t)}function addPlayer(e,t){dungeon=document.getElementById("dungeon");var a=document.createElement("div");a.id="player",a.className="dungeonObject",a.style.width="64px",a.style.height="64px",a.style.backgroundImage="url('static/img/SHC.png')",a.style.backgroundSize="64px 64px ",dungeon.appendChild(a),movePlayer(e,t)}function movePlayer(e,t){var a=document.getElementById("player");1==map.getTile(player.x+e,player.y+t)&&(player.x+=e,player.y+=t,a.style.left=player.x*T_WIDTH+"px",a.style.top=player.y*T_WIDTH-PLAYER_OFFSET+"px")}function checkKey(e){e=e||window.event,"38"==e.keyCode||"87"==e.keyCode?movePlayer(0,-1):"40"==e.keyCode||"83"==e.keyCode?movePlayer(0,1):"37"==e.keyCode||"65"==e.keyCode?movePlayer(-1,0):"39"!=e.keyCode&&"68"!=e.keyCode||movePlayer(1,0)}function moveHere(){Math.abs(this.dataset.x-player.x)>Math.abs(this.dataset.y-player.y)?this.dataset.x-player.x>0?movePlayer(1,0):movePlayer(-1,0):this.dataset.y-player.y>0?movePlayer(0,1):movePlayer(0,-1)}function findPath(){if(player.x!=this.dataset.x||player.y!=this.dataset.y)for(var e=[{x:this.dataset.x,y:this.dataset.y}],t=[];e.length>0;){var a=e.shift();if(t.push(1*a.x+10*a.y),player.x==a.x-1&&player.y==a.y)return void movePlayer(1,0);if(player.x==1*a.x+1&&player.y==a.y)return void movePlayer(-1,0);if(player.x==1*a.x&&player.y==a.y-1)return void movePlayer(0,1);if(player.x==1*a.x&&player.y==1*a.y+1)return void movePlayer(0,-1);0!=map.getTile(1*a.x-1,1*a.y)&&t.indexOf(1*a.x-1+10*a.y)==-1&&e.push({x:1*a.x-1,y:1*a.y}),0!=map.getTile(1*a.x+1,1*a.y)&&t.indexOf(1*a.x+1+10*a.y)==-1&&e.push({x:1*a.x+1,y:1*a.y}),0!=map.getTile(1*a.x,1*a.y-1)&&t.indexOf(1*a.x+10*(1*a.y-1))==-1&&e.push({x:1*a.x,y:1*a.y-1}),0!=map.getTile(1*a.x,1*a.y+1)&&t.indexOf(1*a.x+10*(1*a.y+1))==-1&&e.push({x:1*a.x,y:1*a.y+1})}}function setButton(){tButton=document.getElementById("tButton"),tButton.onclick=demoAjax}window.addEventListener("load",init);const T_WIDTH=64,T_COUNTX=10,T_COUNTY=8,TILE_LOC="static/img/tiles/",PLAYER_OFFSET=20;var map={cols:T_COUNTX,rows:T_COUNTY,tsize:T_WIDTH,tiles:[1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,1,0,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,1,1,0,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,1],getTile:function(e,t){return e>map.cols-1||t>map.rows-1||t<0||e<0?0:this.tiles[t*map.cols+e]}},player={x:0,y:0};window.addEventListener("keydown",function(e){document.activeElement&&document.activeElement!=document.body||([37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),checkKey())},!1);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR1bmdlb24uanMiXSwibmFtZXMiOlsiaW5pdCIsImdldE1hcCIsInNldEJ1dHRvbiIsInhodHRwIiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwianNvbkRhdGEiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJtYXAiLCJ0aWxlcyIsImZpbGxNYXAiLCJhZGRQbGF5ZXIiLCJwbGF5ZXIiLCJ4IiwieSIsIm9wZW4iLCJzZW5kIiwiZ2V0TWFzayIsInRvdGFsIiwibm9ydGgiLCJnZXRUaWxlIiwid2VzdCIsImVhc3QiLCJzb3V0aCIsImNvbnZlcnRlciIsIjIiLCI4IiwiMTAiLCIxMSIsIjE2IiwiMTgiLCIyMiIsIjI0IiwiMjYiLCIyNyIsIjMwIiwiMzEiLCI2NCIsIjY2IiwiNzIiLCI3NCIsIjc1IiwiODAiLCI4MiIsIjg2IiwiODgiLCI5MCIsIjkxIiwiOTQiLCI5NSIsIjEwNCIsIjEwNiIsIjEwNyIsIjEyMCIsIjEyMiIsIjEyMyIsIjEyNiIsIjEyNyIsIjIwOCIsIjIxMCIsIjIxNCIsIjIxNiIsIjIxOCIsIjIxOSIsIjIyMiIsIjIyMyIsIjI0OCIsIjI1MCIsIjI1MSIsIjI1NCIsIjI1NSIsIjAiLCJkdW5nZW9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwid2lkdGgiLCJoZWlnaHQiLCJ0b0FkZCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJpIiwiVF9DT1VOVFkiLCJqIiwiVF9DT1VOVFgiLCJuZXdEaXYiLCJjcmVhdGVFbGVtZW50IiwiaWQiLCJjbGFzc05hbWUiLCJUX1dJRFRIIiwiYmFja2dyb3VuZEltYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbmRQYXRoIiwiZGF0YXNldCIsImFwcGVuZENoaWxkIiwicGxheWVyRGl2IiwiYmFja2dyb3VuZFNpemUiLCJtb3ZlUGxheWVyIiwibGVmdCIsInRvcCIsIlBMQVlFUl9PRkZTRVQiLCJjaGVja0tleSIsImUiLCJ3aW5kb3ciLCJldmVudCIsImtleUNvZGUiLCJtb3ZlSGVyZSIsIk1hdGgiLCJhYnMiLCJ0aGlzIiwicXVldWUiLCJjaGVja2VkIiwibGVuZ3RoIiwiY3VycmVudExvY2F0aW9uIiwic2hpZnQiLCJwdXNoIiwiaW5kZXhPZiIsInRCdXR0b24iLCJvbmNsaWNrIiwiZGVtb0FqYXgiLCJUSUxFX0xPQyIsImNvbHMiLCJyb3dzIiwidHNpemUiLCJjb2wiLCJyb3ciLCJhY3RpdmVFbGVtZW50IiwiYm9keSIsInByZXZlbnREZWZhdWx0Il0sIm1hcHBpbmdzIjoiQUFFQSxRQUFTQSxRQUNQQyxTQUNBQyxZQWdDRixRQUFTRCxVQUNQLEdBQUlFLEdBQVEsR0FBSUMsZUFDaEJELEdBQU1FLG1CQUFxQixXQUN6QixHQUF3QixHQUFwQkYsRUFBTUcsWUFBbUMsS0FBaEJILEVBQU1JLE9BQWUsQ0FDaEQsR0FBSUMsR0FBV0MsS0FBS0MsTUFBTVAsRUFBTVEsYUFDaENDLEtBQUlDLE1BQVFMLEVBQVNJLElBQ3JCRSxRQUFRRixLQUNSRyxVQUFVUCxFQUFTUSxPQUFPQyxFQUFHVCxFQUFTUSxPQUFPRSxLQUdqRGYsRUFBTWdCLEtBQUssTUFBTyxlQUFlLEdBQ2pDaEIsRUFBTWlCLE9BU1IsUUFBU0MsU0FBUUosRUFBR0MsR0FDbEIsR0FBSUksR0FBUSxFQUNSQyxFQUFTLEdBQUtYLElBQUlZLFFBQVFQLEVBQUdDLEVBQUksSUFBTSxHQUN2Q08sRUFBTyxHQUFLYixJQUFJWSxRQUFRUCxFQUFJLEVBQUdDLElBQU0sR0FDckNRLEVBQU8sSUFBTWQsSUFBSVksUUFBUVAsRUFBSSxFQUFHQyxJQUFNLEdBQ3RDUyxFQUFRLElBQU1mLElBQUlZLFFBQVFQLEVBQUdDLEVBQUksSUFBTSxFQUMzQ0ksSUFBU0MsRUFBUUUsRUFBT0MsRUFBT0MsRUFDM0JKLEVBQVEsR0FBS0UsRUFBTyxJQUN0QkgsR0FBVVYsSUFBSVksUUFBUVAsRUFBSSxFQUFHQyxFQUFJLElBQU0sR0FFckNLLEVBQVEsR0FBS0csRUFBTyxJ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LFNBQVNXLEdBQ3BDNUIsU0FBU29ELGVBQWlCcEQsU0FBU29ELGVBQWlCcEQsU0FBU3FELFFBSTdELEdBQUksR0FBSSxHQUFJLElBQUlYLFFBQVFkLEVBQUVHLGFBQzFCSCxFQUFFMEIsaUJBR04zQixjQUNEIiwiZmlsZSI6ImR1bmdlb24ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsid2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGluaXQpO1xuXG5mdW5jdGlvbiBpbml0KCkge1xuICBnZXRNYXAoKTtcbiAgc2V0QnV0dG9uKCk7XG59XG5cbmNvbnN0IFRfV0lEVEggPSA2NDtcbmNvbnN0IFRfQ09VTlRYID0gMTA7XG5jb25zdCBUX0NPVU5UWSA9IDg7XG5jb25zdCBUSUxFX0xPQyA9IFwic3RhdGljL2ltZy90aWxlcy9cIlxuY29uc3QgUExBWUVSX09GRlNFVCA9IDIwO1xuXG5cbnZhciBtYXAgPSB7XG4gIGNvbHM6IFRfQ09VTlRYLFxuICByb3dzOiBUX0NPVU5UWSxcbiAgdHNpemU6IFRfV0lEVEgsXG4gIHRpbGVzOiBbXG4gICAgMSwgMSwgMCwgMCwgMCwgMSwgMSwgMSwgMSwgMSxcbiAgICAxLCAxLCAxLCAxLCAxLCAwLCAwLCAxLCAwLCAxLFxuICAgIDAsIDEsIDEsIDAsIDEsIDAsIDEsIDEsIDAsIDEsXG4gICAgMSwgMCwgMSwgMCwgMSwgMSwgMSwgMSwgMCwgMSxcbiAgICAwLCAwLCAxLCAxLCAwLCAxLCAwLCAxLCAxLCAxLFxuICAgIDAsIDEsIDEsIDEsIDEsIDEsIDEsIDAsIDAsIDEsXG4gICAgMSwgMSwgMSwgMCwgMCwgMSwgMSwgMCwgMCwgMSxcbiAgICAwLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAxXG4gIF0sXG4gIGdldFRpbGU6IGZ1bmN0aW9uKGNvbCwgcm93KSB7XG4gICAgaWYgKGNvbCA+IG1hcC5jb2xzIC0gMSB8fCByb3cgPiBtYXAucm93cyAtIDEgfHwgcm93IDwgMCB8fCBjb2wgPCAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudGlsZXNbcm93ICogbWFwLmNvbHMgKyBjb2xdO1xuICB9XG59O1xuXG5mdW5jdGlvbiBnZXRNYXAgKCkge1xuICB2YXIgeGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgeGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHhodHRwLnJlYWR5U3RhdGUgPT0gNCAmJiB4aHR0cC5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICB2YXIganNvbkRhdGEgPSBKU09OLnBhcnNlKHhodHRwLnJlc3BvbnNlVGV4dCk7XG4gICAgICBtYXAudGlsZXMgPSBqc29uRGF0YS5tYXA7XG4gICAgICBmaWxsTWFwKG1hcCk7XG4gICAgICBhZGRQbGF5ZXIoanNvbkRhdGEucGxheWVyLngsIGpzb25EYXRhLnBsYXllci55KTtcbiAgICB9XG4gIH07XG4gIHhodHRwLm9wZW4oXCJHRVRcIiwgXCJhcGkvZHVuZ2VvblwiLCB0cnVlKTtcbiAgeGh0dHAuc2VuZCgpO1xufVxuXG52YXIgcGxheWVyID0ge1xuICB4OiAwLFxuICB5OiAwXG59O1xuXG5cbmZ1bmN0aW9uIGdldE1hc2soeCwgeSkge1xuICB2YXIgdG90YWwgPSAwO1xuICB2YXIgbm9ydGggPSAgMiAqIChtYXAuZ2V0VGlsZSh4LCB5IC0gMSkgfHwgMCk7XG4gIHZhciB3ZXN0ID0gOCAqIChtYXAuZ2V0VGlsZSh4IC0gMSwgeSkgfHwgMCk7XG4gIHZhciBlYXN0ID0gMTYgKiAobWFwLmdldFRpbGUoeCArIDEsIHkpIHx8IDApO1xuICB2YXIgc291dGggPSA2NCAqIChtYXAuZ2V0VGlsZSh4LCB5ICsgMSkgfHwgMCk7XG4gIHRvdGFsICs9IG5vcnRoICsgd2VzdCArIGVhc3QgKyBzb3V0aDtcbiAgaWYgKG5vcnRoID4gMCAmJiB3ZXN0ID4gMCkge1xuICAgIHRvdGFsICs9IChtYXAuZ2V0VGlsZSh4IC0gMSwgeSAtIDEpIHx8IDApO1xuICB9XG4gIGlmIChub3J0aCA+IDAgJiYgZWFzdCA+IDApIHtcbiAgICB0b3RhbCArPSA0ICogKG1hcC5nZXRUaWxlKHggKyAxLCB5IC0gMSkgfHwgMCk7XG4gIH1cbiAgaWYgKHNvdXRoID4gMCAmJiB3ZXN0ID4gMCkge1xuICAgIHRvdGFsICs9IDMyICogKG1hcC5nZXRUaWxlKHggLSAxLCB5ICsgMSkgfHwgMCk7XG4gIH1cbiAgaWYgKHNvdXRoID4gMCAmJiBlYXN0ID4gMCkge1xuICAgIHRvdGFsICs9IDEyOCAqIChtYXAuZ2V0VGlsZSh4ICsgMSwgeSArIDEpIHx8IDApO1xuICB9XG4gIHZhciBjb252ZXJ0ZXIgPSB7IFwiMlwiIDogMSwgXCI4XCIgOiAyLCBcIjEwXCIgOiAzLCBcIjExXCIgOiA0LCBcIjE2XCIgOiA1LCBcIjE4XCIgOiA2LCBcIjIyXCIgOiA3LCBcIjI0XCIgOiA4LCBcIjI2XCIgOiA5LCBcIjI3XCIgOiAxMCwgXCIzMFwiIDogMTEsIFwiMzFcIiA6IDEyLCBcIjY0XCIgOiAxMywgXCI2NlwiIDogMTQsIFwiNzJcIiA6IDE1LCBcIjc0XCIgOiAxNiwgXCI3NVwiIDogMTcsIFwiODBcIiA6IDE4LCBcIjgyXCIgOiAxOSwgXCI4NlwiIDogMjAsIFwiODhcIiA6IDIxLCBcIjkwXCIgOiAyMiwgXCI5MVwiIDogMjMsIFwiOTRcIiA6IDI0LCBcIjk1XCIgOiAyNSwgXCIxMDRcIiA6IDI2LCBcIjEwNlwiIDogMjcsIFwiMTA3XCIgOiAyOCwgXCIxMjBcIiA6IDI5LCBcIjEyMlwiIDogMzAsIFwiMTIzXCIgOiAzMSwgXCIxMjZcIiA6IDMyLCBcIjEyN1wiIDogMzMsIFwiMjA4XCIgOiAzNCwgXCIyMTBcIiA6IDM1LCBcIjIxNFwiIDogMzYsIFwiMjE2XCIgOiAzNywgXCIyMThcIiA6IDM4LCBcIjIxOVwiIDogMzksIFwiMjIyXCIgOiA0MCwgXCIyMjNcIiA6IDQxLCBcIjI0OFwiIDogNDIsIFwiMjUwXCIgOiA0MywgXCIyNTFcIiA6IDQ0LCBcIjI1NFwiIDogNDUsIFwiMjU1XCIgOiA0NiwgXCIwXCIgOiA0NyB9O1xuICByZXR1cm4gY29udmVydGVyW3RvdGFsICsgXCJcIl07XG59XG5cbmZ1bmN0aW9uIGZpbGxNYXAobWFwKSB7XG4gIGR1bmdlb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHVuZ2VvbicpO1xuICBkdW5nZW9uLnN0eWxlLndpZHRoID0gKFRfV0lEVEggKiBUX0NPVU5UWCkgKyBcInB4XCI7XG4gIGR1bmdlb24uc3R5bGUuaGVpZ2h0ID0gKFRfV0lEVEggKiBUX0NPVU5UWSkgKyBcInB4XCI7XG5cbiAgdmFyIHRvQWRkID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IFRfQ09VTlRZOyBpKyspIHtcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IFRfQ09VTlRYOyBqKyspIHtcbiAgICAgICB2YXIgbmV3RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgbmV3RGl2LmlkID0gaiArIFwiX1wiICsgaTtcbiAgICAgICBuZXdEaXYuY2xhc3NOYW1lID0gJ2R1bmdlb25UaWxlJztcbiAgICAgICBuZXdEaXYuc3R5bGUud2lkdGggPSBUX1dJRFRIICsgXCJweFwiO1xuICAgICAgIG5ld0Rpdi5zdHlsZS5oZWlnaHQgPSBUX1dJRFRIICsgXCJweFwiO1xuICAgICAgIGlmIChtYXAuZ2V0VGlsZShqLCBpKSA+IDApIHtcbiAgICAgICAgIG5ld0Rpdi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnc3RhdGljL2ltZy90aWxlcy9cIiArIGdldE1hc2soaiwgaSkgKyBcIi5wbmcnKVwiO1xuICAgICAgIH1cbiAgICAgICBuZXdEaXYuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZpbmRQYXRoKTtcbiAgICAgICBuZXdEaXYuZGF0YXNldC54ID0gajtcbiAgICAgICBuZXdEaXYuZGF0YXNldC55ID0gaTtcbiAgICAgICB0b0FkZC5hcHBlbmRDaGlsZChuZXdEaXYpO1xuICAgIH1cbiAgfVxuICBkdW5nZW9uLmFwcGVuZENoaWxkKHRvQWRkKTtcbn1cblxuZnVuY3Rpb24gYWRkUGxheWVyKHgsIHkpIHtcbiAgZHVuZ2VvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkdW5nZW9uJyk7XG4gIHZhciBwbGF5ZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgcGxheWVyRGl2LmlkID0gJ3BsYXllcic7XG4gIHBsYXllckRpdi5jbGFzc05hbWUgPSAnZHVuZ2Vvbk9iamVjdCc7XG4gIHBsYXllckRpdi5zdHlsZS53aWR0aCA9IFRfV0lEVEggKyBcInB4XCI7XG4gIHBsYXllckRpdi5zdHlsZS5oZWlnaHQgPSBUX1dJRFRIICsgXCJweFwiO1xuICBwbGF5ZXJEaXYuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoJ3N0YXRpYy9pbWcvU0hDLnBuZycpXCI7XG4gIHBsYXllckRpdi5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9ICBUX1dJRFRIICsgXCJweCBcIiArIFRfV0lEVEggKyBcInB4IFwiO1xuICBkdW5nZW9uLmFwcGVuZENoaWxkKHBsYXllckRpdik7XG4gIG1vdmVQbGF5ZXIoeCwgeSk7XG59XG5cbmZ1bmN0aW9uIG1vdmVQbGF5ZXIoeCwgeSkge1xuICB2YXIgcGxheWVyRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllcicpO1xuICBpZiAobWFwLmdldFRpbGUocGxheWVyLnggKyB4LCBwbGF5ZXIueSArIHkpID09IDEpIHtcbiAgICBwbGF5ZXIueCArPSB4O1xuICAgIHBsYXllci55ICs9IHk7XG4gICAgcGxheWVyRGl2LnN0eWxlLmxlZnQgPSAgKHBsYXllci54ICogVF9XSURUSCkgKyBcInB4XCI7XG4gICAgcGxheWVyRGl2LnN0eWxlLnRvcCA9ICAocGxheWVyLnkgKiBUX1dJRFRIIC0gUExBWUVSX09GRlNFVCkgKyBcInB4XCI7XG4gIH1cbn1cblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICE9IGRvY3VtZW50LmJvZHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gc3BhY2UgYW5kIGFycm93IGtleXNcbiAgICBpZihbMzcsIDM4LCAzOSwgNDBdLmluZGV4T2YoZS5rZXlDb2RlKSA+IC0xKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBjaGVja0tleSgpO1xufSwgZmFsc2UpO1xuXG5mdW5jdGlvbiBjaGVja0tleShlKSB7XG4gICAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuXG4gICAgaWYgKGUua2V5Q29kZSA9PSAnMzgnIHx8IGUua2V5Q29kZSA9PSAnODcnKSB7XG4gICAgICAvLyB1cCBhcnJvd1xuICAgICAgbW92ZVBsYXllcigwLCAtMSk7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzQwJyB8fCBlLmtleUNvZGUgPT0gJzgzJykge1xuICAgICAgLy8gZG93biBhcnJvd1xuICAgICAgbW92ZVBsYXllcigwLCAxKTtcbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAnMzcnIHx8IGUua2V5Q29kZSA9PSAnNjUnKSB7XG4gICAgICAgLy8gbGVmdCBhcnJvd1xuICAgICAgIG1vdmVQbGF5ZXIoLTEsIDApO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09ICczOScgfHwgZS5rZXlDb2RlID09ICc2OCcpIHtcbiAgICAgICAvLyByaWdodCBhcnJvd1xuICAgICAgIG1vdmVQbGF5ZXIoMSwgMCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBtb3ZlSGVyZSAoKSB7XG4gIGlmIChNYXRoLmFicyh0aGlzLmRhdGFzZXQueCAtIHBsYXllci54KSA+ICBNYXRoLmFicyh0aGlzLmRhdGFzZXQueSAtIHBsYXllci55KSkge1xuICAgIGlmICh0aGlzLmRhdGFzZXQueCAtIHBsYXllci54ID4gMCkge1xuICAgICAgbW92ZVBsYXllcigxLCAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbW92ZVBsYXllcigtMSwgMCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLmRhdGFzZXQueSAtIHBsYXllci55ID4gMCkge1xuICAgICAgbW92ZVBsYXllcigwLCAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbW92ZVBsYXllcigwLCAtMSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGZpbmRQYXRoKCkge1xuICBpZiAocGxheWVyLnggPT0gdGhpcy5kYXRhc2V0LnggJiYgcGxheWVyLnkgPT0gdGhpcy5kYXRhc2V0LnkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHF1ZXVlID0gW3t4IDogdGhpcy5kYXRhc2V0LngsIHkgOiB0aGlzLmRhdGFzZXQueX1dO1xuICB2YXIgY2hlY2tlZCA9IFtdO1xuICB2YXIgZm91bmQgPSBmYWxzZTtcbiAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICB2YXIgY3VycmVudExvY2F0aW9uID0gcXVldWUuc2hpZnQoKTtcbiAgICBjaGVja2VkLnB1c2goMSAqIGN1cnJlbnRMb2NhdGlvbi54ICsgMTAgKiBjdXJyZW50TG9jYXRpb24ueSk7XG4gICAgaWYgKHBsYXllci54ID09IGN1cnJlbnRMb2NhdGlvbi54IC0gMSAmJiBwbGF5ZXIueSA9PSBjdXJyZW50TG9jYXRpb24ueSkge1xuICAgICAgbW92ZVBsYXllcigxLCAwKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKHBsYXllci54ID09IDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEgJiYgcGxheWVyLnkgPT0gY3VycmVudExvY2F0aW9uLnkpIHtcbiAgICAgIG1vdmVQbGF5ZXIoLTEsIDApO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAocGxheWVyLnggPT0gMSAqIGN1cnJlbnRMb2NhdGlvbi54ICYmIHBsYXllci55ID09IGN1cnJlbnRMb2NhdGlvbi55IC0gMSkge1xuICAgICAgbW92ZVBsYXllcigwLCAxKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKHBsYXllci54ID09IDEgKiBjdXJyZW50TG9jYXRpb24ueCAmJiBwbGF5ZXIueSA9PSAxICogY3VycmVudExvY2F0aW9uLnkgKyAxKSB7XG4gICAgICBtb3ZlUGxheWVyKDAsIC0xKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLnggLSAxLCAxICogY3VycmVudExvY2F0aW9uLnkpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggLSAxICsgMTAgKiBjdXJyZW50TG9jYXRpb24ueSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCAtIDEsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnl9KTtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLnggKyAxLCAxICogY3VycmVudExvY2F0aW9uLnkpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggKyAxICsgMTAgKiBjdXJyZW50TG9jYXRpb24ueSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnl9KTtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLngsIDEgKiBjdXJyZW50TG9jYXRpb24ueSAtIDEpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggKyAxMCAqICgxICogY3VycmVudExvY2F0aW9uLnkgLSAxKSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCwgeSA6IDEgKiBjdXJyZW50TG9jYXRpb24ueSAtIDF9KTtcbiAgICB9XG4gICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLngsIDEgKiBjdXJyZW50TG9jYXRpb24ueSArIDEpICE9IDApICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggKyAxMCAqICgxICogY3VycmVudExvY2F0aW9uLnkgKyAxKSkgPT0gLTEpIHtcbiAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCwgeSA6IDEgKiBjdXJyZW50TG9jYXRpb24ueSArIDF9KTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gc2V0QnV0dG9uKCkge1xuICB0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0QnV0dG9uXCIpO1xuICB0QnV0dG9uLm9uY2xpY2sgPSBkZW1vQWpheDtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
