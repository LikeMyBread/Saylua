var makeDungeon=function(e,t){function n(){h=document.getElementById(t),i()}function i(){h.innerHTML="",reqwest({url:f,method:"GET",type:"json",success:function(e){var t=e;w.tiles=t.map,a(w),d(t.player.x,t.player.y),o(t.actors)}})}function a(e){h.style.width="640px",h.style.height="512px";for(var t=document.createDocumentFragment(),n=0;n<p;n++)for(var i=0;i<c;i++){var a=document.createElement("div");a.id=i+"_"+n,a.className="dungeonTile",a.style.width="64px",a.style.height="64px","exit"==e.getTile(i,n).landmark?a.style.backgroundColor="#FF0000":a.style.backgroundColor=v[e.getTile(i,n).type],a.addEventListener("click",u),a.dataset.x=i,a.dataset.y=n,t.appendChild(a)}h.appendChild(t)}function l(e){return result=document.createElement("div"),result.className="dungeonObject",result.style.width="64px",result.style.height="64px",result.style.backgroundImage="url('"+e+"')",result.style.backgroundSize="64px 64px ",result}function r(e,t,n){e.style.left=t*x+"px",e.style.top=n*x+"px"}function o(e){b=e;for(var t=0;t<e.length;t++){var n=l(k[e[t].type]);r(n,e[t].x,e[t].y),h.appendChild(n)}}function d(e,t){m=l("/static/img/SHC.png"),C={x:e,y:t},m.id="player",r(m,C.x,C.y),h.appendChild(m)}function y(e,t){if(!T)return!1;var n=w.getTile(C.x+e,C.y+t);n.walkable&&(T=!1,reqwest({url:g,method:"POST",data:C,type:"json",success:function(a){T=!0,"exit"==n.landmark?i():(C.x+=e,C.y+=t,r(m,C.x,C.y))},error:function(e){T=!0}}))}function s(t){t=t||e.event,"38"==t.keyCode||"87"==t.keyCode?y(0,-1):"40"==t.keyCode||"83"==t.keyCode?y(0,1):"37"==t.keyCode||"65"==t.keyCode?y(-1,0):"39"!=t.keyCode&&"68"!=t.keyCode||y(1,0)}function u(){if(C.x!=this.dataset.x||C.y!=this.dataset.y)for(var e=[{x:this.dataset.x,y:this.dataset.y}],t=[];e.length>0;){var n=e.shift();if(t.push(1*n.x+10*n.y),C.x==n.x-1&&C.y==n.y)return void y(1,0);if(C.x==1*n.x+1&&C.y==n.y)return void y(-1,0);if(C.x==1*n.x&&C.y==n.y-1)return void y(0,1);if(C.x==1*n.x&&C.y==1*n.y+1)return void y(0,-1);w.getTile(1*n.x-1,1*n.y).walkable&&t.indexOf(1*n.x-1+10*n.y)==-1&&e.push({x:1*n.x-1,y:1*n.y}),w.getTile(1*n.x+1,1*n.y).walkable&&t.indexOf(1*n.x+1+10*n.y)==-1&&e.push({x:1*n.x+1,y:1*n.y}),w.getTile(1*n.x,1*n.y-1).walkable&&t.indexOf(1*n.x+10*(1*n.y-1))==-1&&e.push({x:1*n.x,y:1*n.y-1}),w.getTile(1*n.x,1*n.y+1).walkable&&t.indexOf(1*n.x+10*(1*n.y+1))==-1&&e.push({x:1*n.x,y:1*n.y+1})}}const x=64,c=10,p=8,f="/api/explore/map/",g="/api/explore/move/";var h,m,v={water:"lightblue",dirt:"#DEB887",cave_wall:"#322125"},k={pet:"/static/img/velbird.png"},w={cols:c,rows:p,tsize:x,tiles:new Array(80),getTile:function(e,t){return e>w.cols-1||t>w.rows-1||t<0||e<0?0:this.tiles[t*w.cols+e]}},C={x:0,y:0},b=[],T=!0;return e.addEventListener("keydown",function(e){document.activeElement&&document.activeElement!=document.body||([37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),s())},!1),n}(window,"dungeon");window.addEventListener("load",makeDungeon);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR1bmdlb24uanMiXSwibmFtZXMiOlsibWFrZUR1bmdlb24iLCJ3aW5kb3ciLCJkdW5nZW9uSWQiLCJpbml0X21hcCIsImR1bmdlb24iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0TWFwIiwiaW5uZXJIVE1MIiwicmVxd2VzdCIsInVybCIsIkFQSV9NQVBfRU5EUE9JTlQiLCJtZXRob2QiLCJ0eXBlIiwic3VjY2VzcyIsInJlc3AiLCJqc29uRGF0YSIsIm1hcCIsInRpbGVzIiwicmVuZGVyTWFwIiwiYWRkUGxheWVyIiwicGxheWVyIiwieCIsInkiLCJhZGRBY3RvcnMiLCJhY3RvcnMiLCJzdHlsZSIsIndpZHRoIiwiaGVpZ2h0IiwidG9BZGQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiaSIsIlRfQ09VTlRZIiwiaiIsIlRfQ09VTlRYIiwibmV3RGl2IiwiY3JlYXRlRWxlbWVudCIsImlkIiwiY2xhc3NOYW1lIiwiVF9XSURUSCIsImdldFRpbGUiLCJsYW5kbWFyayIsImJhY2tncm91bmRDb2xvciIsInRpbGVMaXN0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbmRQYXRoIiwiZGF0YXNldCIsImFwcGVuZENoaWxkIiwiY3JlYXRlQWN0b3JFbGVtZW50IiwiaW1nVXJsIiwicmVzdWx0IiwiYmFja2dyb3VuZEltYWdlIiwiYmFja2dyb3VuZFNpemUiLCJyZW5kZXJBY3RvckxvY2F0aW9uIiwiZWxlbWVudCIsImxlZnQiLCJ0b3AiLCJhY3RvckRhdGEiLCJsZW5ndGgiLCJhY3Rvckxpc3QiLCJwbGF5ZXJEaXYiLCJtb3ZlUGxheWVyIiwiY2FuTW92ZSIsInRhcmdldCIsIndhbGthYmxlIiwiQVBJX01PVkVfRU5EUE9JTlQiLCJkYXRhIiwiZXJyb3IiLCJlcnIiLCJjaGVja0tleSIsImUiLCJldmVudCIsImtleUNvZGUiLCJ0aGlzIiwicXVldWUiLCJjaGVja2VkIiwiY3VycmVudExvY2F0aW9uIiwic2hpZnQiLCJwdXNoIiwiaW5kZXhPZiIsIndhdGVyIiwiZGlydCIsImNhdmVfd2FsbCIsInBldCIsImNvbHMiLCJyb3dzIiwidHNpemUiLCJBcnJheSIsImNvbCIsInJvdyIsImFjdGl2ZUVsZW1lbnQiLCJib2R5IiwicHJldmVudERlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUlBLGFBQWMsU0FBVUMsRUFBUUMsR0FnRGxDLFFBQVNDLEtBQ1BDLEVBQVVDLFNBQVNDLGVBQWVKLEdBQ2xDSyxJQUdGLFFBQVNBLEtBQ1BILEVBQVFJLFVBQVksR0FDcEJDLFNBQ0VDLElBQUtDLEVBQ0xDLE9BQVEsTUFDUkMsS0FBTSxPQUNOQyxRQUFTLFNBQVVDLEdBQ2pCLEdBQUlDLEdBQVdELENBQ2ZFLEdBQUlDLE1BQVFGLEVBQVNDLElBQ3JCRSxFQUFVRixHQUNWRyxFQUFVSixFQUFTSyxPQUFPQyxFQUFHTixFQUFTSyxPQUFPRSxHQUM3Q0MsRUFBVVIsRUFBU1MsV0FLekIsUUFBU04sR0FBVUYsR0FDakJiLEVBQVFzQixNQUFNQyxNQUFRLFFBQ3RCdkIsRUFBUXNCLE1BQU1FLE9BQVMsT0FHdkIsS0FBSyxHQUREQyxHQUFReEIsU0FBU3lCLHlCQUNaQyxFQUFJLEVBQUdBLEVBQUlDLEVBQVVELElBQzVCLElBQUssR0FBSUUsR0FBSSxFQUFHQSxFQUFJQyxFQUFVRCxJQUFLLENBQ2hDLEdBQUlFLEdBQVM5QixTQUFTK0IsY0FBYyxNQUNwQ0QsR0FBT0UsR0FBS0osRUFBSSxJQUFNRixFQUN0QkksRUFBT0csVUFBWSxjQUNuQkgsRUFBT1QsTUFBTUMsTUFBUVksT0FDckJKLEVBQU9ULE1BQU1FLE9BQVNXLE9BQ1ksUUFBOUJ0QixFQUFJdUIsUUFBUVAsRUFBR0YsR0FBR1UsU0FFcEJOLEVBQU9ULE1BQU1nQixnQkFBa0IsVUFFL0JQLEVBQU9ULE1BQU1nQixnQkFBa0JDLEVBQVMxQixFQUFJdUIsUUFBUVAsRUFBR0YsR0FBR2xCLE1BRTVEc0IsRUFBT1MsaUJBQWlCLFFBQVNDLEdBQ2pDVixFQUFPVyxRQUFReEIsRUFBSVcsRUFDbkJFLEVBQU9XLFFB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QnRELEVBQUdDLEVBQUksRUFBSXFELEVBQWdCckQsRUFBSSxLQS9PM0UsS0FBTWdCLEdBQVUsR0FDVkwsRUFBVyxHQUNYRixFQUFXLEVBRVhyQixFQUFtQixvQkFDbkJzRCxFQUFvQixvQkFFMUIsSUFBSTdELEdBNkJBd0QsRUEzQkFqQixHQUNGcUMsTUFBVSxZQUNWQyxLQUFTLFVBQ1RDLFVBQWMsV0FPWnZCLEdBQ0Z3QixJQUFRLDJCQUdObEUsR0FDRm1FLEtBQU1sRCxFQUNObUQsS0FBTXJELEVBQ05zRCxNQUFPL0MsRUFDUHJCLE1BQU8sR0FBSXFFLE9BQU12RCxJQUNqQlEsUUFBUyxTQUFTZ0QsRUFBS0MsR0FDckIsTUFBSUQsR0FBTXZFLEVBQUltRSxLQUFPLEdBQUtLLEVBQU14RSxFQUFJb0UsS0FBTyxHQUFLSSxFQUFNLEdBQUtELEVBQU0sRUFDeEQsRUFFRmYsS0FBS3ZELE1BQU11RSxFQUFNeEUsRUFBSW1FLEtBQU9JLEtBTW5DbkUsR0FDRkMsRUFBRyxFQUNIQyxFQUFHLEdBR0RFLEtBRUFxQyxHQUFVLENBc01kLE9BbkZBN0QsR0FBTzJDLGlCQUFpQixVQUFXLFNBQVMwQixHQUNwQ2pFLFNBQVNxRixlQUFpQnJGLFNBQVNxRixlQUFpQnJGLFNBQVNzRixRQUk3RCxHQUFJLEdBQUksR0FBSSxJQUFJWixRQUFRVCxFQUFFRSxhQUM1QkYsRUFBRXNCLGlCQUdKdkIsT0FDRCxHQXlFSWxFLEdBQ1BGLE9BQVEsVUFFVkEsUUFBTzJDLGlCQUFpQixPQUFRNUMiLCJmaWxlIjoiZHVuZ2Vvbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbWFrZUR1bmdlb24gPSBmdW5jdGlvbiAod2luZG93LCBkdW5nZW9uSWQpIHtcbiAgY29uc3QgVF9XSURUSCA9IDY0O1xuICBjb25zdCBUX0NPVU5UWCA9IDEwO1xuICBjb25zdCBUX0NPVU5UWSA9IDg7XG4gIGNvbnN0IFRJTEVfTE9DID0gJy9zdGF0aWMvaW1nL3RpbGVzLyc7XG4gIGNvbnN0IEFQSV9NQVBfRU5EUE9JTlQgPSAnL2FwaS9leHBsb3JlL21hcC8nO1xuICBjb25zdCBBUElfTU9WRV9FTkRQT0lOVCA9ICcvYXBpL2V4cGxvcmUvbW92ZS8nO1xuXG4gIHZhciBkdW5nZW9uO1xuXG4gIHZhciB0aWxlTGlzdCA9IHtcbiAgICAnd2F0ZXInIDogJ2xpZ2h0Ymx1ZScsXG4gICAgJ2RpcnQnIDogJyNERUI4ODcnLFxuICAgICdjYXZlX3dhbGwnIDogJyMzMjIxMjUnLFxuICB9O1xuXG4gIHZhciBsYW5kbWFya0xpc3QgPSB7XG4gICAgJ2V4aXQnIDogJzxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiBibGFjazsgYm9yZGVyLXJhZGl1czogNTAlOyBcIj48L2Rpdj4nLFxuICB9O1xuXG4gIHZhciBhY3Rvckxpc3QgPSB7XG4gICAgJ3BldCcgOiAnL3N0YXRpYy9pbWcvdmVsYmlyZC5wbmcnLFxuICB9O1xuXG4gIHZhciBtYXAgPSB7XG4gICAgY29sczogVF9DT1VOVFgsXG4gICAgcm93czogVF9DT1VOVFksXG4gICAgdHNpemU6IFRfV0lEVEgsXG4gICAgdGlsZXM6IG5ldyBBcnJheShUX0NPVU5UWSAqIFRfQ09VTlRYKSxcbiAgICBnZXRUaWxlOiBmdW5jdGlvbihjb2wsIHJvdykge1xuICAgICAgaWYgKGNvbCA+IG1hcC5jb2xzIC0gMSB8fCByb3cgPiBtYXAucm93cyAtIDEgfHwgcm93IDwgMCB8fCBjb2wgPCAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMudGlsZXNbcm93ICogbWFwLmNvbHMgKyBjb2xdO1xuICAgIH1cbiAgfTtcblxuICB2YXIgcGxheWVyRGl2O1xuXG4gIHZhciBwbGF5ZXIgPSB7XG4gICAgeDogMCxcbiAgICB5OiAwXG4gIH07XG5cbiAgdmFyIGFjdG9ycyA9IFtdO1xuXG4gIHZhciBjYW5Nb3ZlID0gdHJ1ZTtcblxuICBmdW5jdGlvbiBpbml0X21hcCAoKSB7XG4gICAgZHVuZ2VvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGR1bmdlb25JZCk7XG4gICAgZ2V0TWFwKCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRNYXAoKSB7XG4gICAgZHVuZ2Vvbi5pbm5lckhUTUwgPSBcIlwiO1xuICAgIHJlcXdlc3Qoe1xuICAgICAgdXJsOiBBUElfTUFQX0VORFBPSU5ULFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIHR5cGU6ICdqc29uJyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICAgIHZhciBqc29uRGF0YSA9IHJlc3A7XG4gICAgICAgIG1hcC50aWxlcyA9IGpzb25EYXRhLm1hcDtcbiAgICAgICAgcmVuZGVyTWFwKG1hcCk7XG4gICAgICAgIGFkZFBsYXllcihqc29uRGF0YS5wbGF5ZXIueCwganNvbkRhdGEucGxheWVyLnkpO1xuICAgICAgICBhZGRBY3RvcnMoanNvbkRhdGEuYWN0b3JzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlck1hcChtYXApIHtcbiAgICBkdW5nZW9uLnN0eWxlLndpZHRoID0gKFRfV0lEVEggKiBUX0NPVU5UWCkgKyBcInB4XCI7XG4gICAgZHVuZ2Vvbi5zdHlsZS5oZWlnaHQgPSAoVF9XSURUSCAqIFRfQ09VTlRZKSArIFwicHhcIjtcblxuICAgIHZhciB0b0FkZCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IFRfQ09VTlRZOyBpKyspIHtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgVF9DT1VOVFg7IGorKykge1xuICAgICAgICAgdmFyIG5ld0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgbmV3RGl2LmlkID0gaiArIFwiX1wiICsgaTtcbiAgICAgICAgIG5ld0Rpdi5jbGFzc05hbWUgPSAnZHVuZ2VvblRpbGUnO1xuICAgICAgICAgbmV3RGl2LnN0eWxlLndpZHRoID0gVF9XSURUSCArIFwicHhcIjtcbiAgICAgICAgIG5ld0Rpdi5zdHlsZS5oZWlnaHQgPSBUX1dJRFRIICsgXCJweFwiO1xuICAgICAgICAgaWYgKG1hcC5nZXRUaWxlKGosIGkpLmxhbmRtYXJrID09ICdleGl0Jykge1xuICAgICAgICAgICAvLyBFeGl0XG4gICAgICAgICAgIG5ld0Rpdi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNGRjAwMDBcIjtcbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgIG5ld0Rpdi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB0aWxlTGlzdFttYXAuZ2V0VGlsZShqLCBpKS50eXBlXTtcbiAgICAgICAgIH1cbiAgICAgICAgIG5ld0Rpdi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZmluZFBhdGgpO1xuICAgICAgICAgbmV3RGl2LmRhdGFzZXQueCA9IGo7XG4gICAgICAgICBuZXdEaXYuZGF0YXNldC55ID0gaTtcbiAgICAgICAgIHRvQWRkLmFwcGVuZENoaWxkKG5ld0Rpdik7XG4gICAgICB9XG4gICAgfVxuICAgIGR1bmdlb24uYXBwZW5kQ2hpbGQodG9BZGQpO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlQWN0b3JFbGVtZW50KGltZ1VybCkge1xuICAgIHJlc3VsdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHJlc3VsdC5jbGFzc05hbWUgPSAnZHVuZ2Vvbk9iamVjdCc7XG4gICAgcmVzdWx0LnN0eWxlLndpZHRoID0gVF9XSURUSCArIFwicHhcIjtcbiAgICByZXN1bHQuc3R5bGUuaGVpZ2h0ID0gVF9XSURUSCArIFwicHhcIjtcbiAgICByZXN1bHQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoJ1wiICsgaW1nVXJsICsgXCInKVwiO1xuICAgIHJlc3VsdC5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9ICBUX1dJRFRIICsgXCJweCBcIiArIFRfV0lEVEggKyBcInB4IFwiO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJBY3RvckxvY2F0aW9uKGVsZW1lbnQsIHgsIHkpIHtcbiAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSAgKHggKiBUX1dJRFRIKSArIFwicHhcIjtcbiAgICBlbGVtZW50LnN0eWxlLnRvcCA9ICAoeSAqIFRfV0lEVEgpICsgXCJweFwiO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkQWN0b3JzKGFjdG9yRGF0YSkge1xuICAgIGFjdG9ycyA9IGFjdG9yRGF0YTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjdG9yRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGVsZW1lbnQgPSBjcmVhdGVBY3RvckVsZW1lbnQoYWN0b3JMaXN0W2FjdG9yRGF0YVtpXS50eXBlXSk7XG4gICAgICByZW5kZXJBY3RvckxvY2F0aW9uKGVsZW1lbnQsIGFjdG9yRGF0YVtpXS54LCBhY3RvckRhdGFbaV0ueSk7XG4gICAgICBkdW5nZW9uLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZFBsYXllcih4LCB5KSB7XG4gICAgcGxheWVyRGl2ID0gY3JlYXRlQWN0b3JFbGVtZW50KCcvc3RhdGljL2ltZy9TSEMucG5nJyk7XG4gICAgcGxheWVyID0ge1xuICAgICAgJ3gnOiB4LFxuICAgICAgJ3knOiB5XG4gICAgfTtcbiAgICBwbGF5ZXJEaXYuaWQgPSAncGxheWVyJztcbiAgICByZW5kZXJBY3RvckxvY2F0aW9uKHBsYXllckRpdiwgcGxheWVyLngsIHBsYXllci55KTtcbiAgICBkdW5nZW9uLmFwcGVuZENoaWxkKHBsYXllckRpdik7XG4gIH1cblxuICBmdW5jdGlvbiBtb3ZlUGxheWVyKHgsIHkpIHtcbiAgICBpZiAoIWNhbk1vdmUpIHJldHVybiBmYWxzZTtcblxuICAgIHZhciB0YXJnZXQgPSBtYXAuZ2V0VGlsZShwbGF5ZXIueCArIHgsIHBsYXllci55ICsgeSk7XG4gICAgaWYgKHRhcmdldC53YWxrYWJsZSkge1xuICAgICAgY2FuTW92ZSA9IGZhbHNlO1xuICAgICAgcmVxd2VzdCh7XG4gICAgICAgIHVybDogQVBJX01PVkVfRU5EUE9JTlQsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBkYXRhOiBwbGF5ZXIsXG4gICAgICAgIHR5cGU6ICdqc29uJyxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3ApIHtcbiAgICAgICAgICBjYW5Nb3ZlID0gdHJ1ZTtcbiAgICAgICAgICBpZiAodGFyZ2V0LmxhbmRtYXJrID09ICdleGl0Jykge1xuICAgICAgICAgICAgLy8gRXhpdHRpbmcgdGhlIGR1bmdlb25cbiAgICAgICAgICAgIGdldE1hcCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwbGF5ZXIueCArPSB4O1xuICAgICAgICAgICAgcGxheWVyLnkgKz0geTtcbiAgICAgICAgICAgIHJlbmRlckFjdG9yTG9jYXRpb24ocGxheWVyRGl2LCBwbGF5ZXIueCwgcGxheWVyLnkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBjYW5Nb3ZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gQWxsb3cgcGxheWVyIHRvIHVzZSBhcnJvdyBrZXlzIHRvIG1vdmVcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT0gZG9jdW1lbnQuYm9keSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAvLyBzcGFjZSBhbmQgYXJyb3cga2V5c1xuICAgICAgaWYoWzM3LCAzOCwgMzksIDQwXS5pbmRleE9mKGUua2V5Q29kZSkgPiAtMSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG5cbiAgICAgIGNoZWNrS2V5KCk7XG4gIH0sIGZhbHNlKTtcblxuICBmdW5jdGlvbiBjaGVja0tleShlKSB7XG4gICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG5cbiAgICAgIGlmIChlLmtleUNvZGUgPT0gJzM4JyB8fCBlLmtleUNvZGUgPT0gJzg3Jykge1xuICAgICAgICAvLyB1cCBhcnJvd1xuICAgICAgICBtb3ZlUGxheWVyKDAsIC0xKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09ICc0MCcgfHwgZS5rZXlDb2RlID09ICc4MycpIHtcbiAgICAgICAgLy8gZG93biBhcnJvd1xuICAgICAgICBtb3ZlUGxheWVyKDAsIDEpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM3JyB8fCBlLmtleUNvZGUgPT0gJzY1Jykge1xuICAgICAgICAvLyBsZWZ0IGFycm93XG4gICAgICAgIG1vdmVQbGF5ZXIoLTEsIDApO1xuICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM5JyB8fCBlLmtleUNvZGUgPT0gJzY4Jykge1xuICAgICAgICAvLyByaWdodCBhcnJvd1xuICAgICAgICBtb3ZlUGxheWVyKDEsIDApO1xuICAgICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gbW92ZUhlcmUgKCkge1xuICAgIGlmIChNYXRoLmFicyh0aGlzLmRhdGFzZXQueCAtIHBsYXllci54KSA+ICBNYXRoLmFicyh0aGlzLmRhdGFzZXQueSAtIHBsYXllci55KSkge1xuICAgICAgaWYgKHRoaXMuZGF0YXNldC54IC0gcGxheWVyLnggPiAwKSB7XG4gICAgICAgIG1vdmVQbGF5ZXIoMSwgMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtb3ZlUGxheWVyKC0xLCAwKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuZGF0YXNldC55IC0gcGxheWVyLnkgPiAwKSB7XG4gICAgICAgIG1vdmVQbGF5ZXIoMCwgMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtb3ZlUGxheWVyKDAsIC0xKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kUGF0aCgpIHtcbiAgICBpZiAocGxheWVyLnggPT0gdGhpcy5kYXRhc2V0LnggJiYgcGxheWVyLnkgPT0gdGhpcy5kYXRhc2V0LnkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHF1ZXVlID0gW3t4IDogdGhpcy5kYXRhc2V0LngsIHkgOiB0aGlzLmRhdGFzZXQueX1dO1xuICAgIHZhciBjaGVja2VkID0gW107XG4gICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgIHZhciBjdXJyZW50TG9jYXRpb24gPSBxdWV1ZS5zaGlmdCgpO1xuICAgICAgY2hlY2tlZC5wdXNoKDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEwICogY3VycmVudExvY2F0aW9uLnkpO1xuICAgICAgaWYgKHBsYXllci54ID09IGN1cnJlbnRMb2NhdGlvbi54IC0gMSAmJiBwbGF5ZXIueSA9PSBjdXJyZW50TG9jYXRpb24ueSkge1xuICAgICAgICBtb3ZlUGxheWVyKDEsIDApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKHBsYXllci54ID09IDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEgJiYgcGxheWVyLnkgPT0gY3VycmVudExvY2F0aW9uLnkpIHtcbiAgICAgICAgbW92ZVBsYXllcigtMSwgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAocGxheWVyLnggPT0gMSAqIGN1cnJlbnRMb2NhdGlvbi54ICYmIHBsYXllci55ID09IGN1cnJlbnRMb2NhdGlvbi55IC0gMSkge1xuICAgICAgICBtb3ZlUGxheWVyKDAsIDEpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKHBsYXllci54ID09IDEgKiBjdXJyZW50TG9jYXRpb24ueCAmJiBwbGF5ZXIueSA9PSAxICogY3VycmVudExvY2F0aW9uLnkgKyAxKSB7XG4gICAgICAgIG1vdmVQbGF5ZXIoMCwgLTEpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoKG1hcC5nZXRUaWxlKDEgKiBjdXJyZW50TG9jYXRpb24ueCAtIDEsIDEgKiBjdXJyZW50TG9jYXRpb24ueSkud2Fsa2FibGUpICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggLSAxICsgMTAgKiBjdXJyZW50TG9jYXRpb24ueSkgPT0gLTEpIHtcbiAgICAgICAgICBxdWV1ZS5wdXNoKHt4IDogMSAqIGN1cnJlbnRMb2NhdGlvbi54IC0gMSwgeSA6IDEgKiBjdXJyZW50TG9jYXRpb24ueX0pO1xuICAgICAgfVxuICAgICAgaWYgKChtYXAuZ2V0VGlsZSgxICogY3VycmVudExvY2F0aW9uLnggKyAxLCAxICogY3VycmVudExvY2F0aW9uLnkpLndhbGthYmxlKSAmJiBjaGVja2VkLmluZGV4T2YoMSAqIGN1cnJlbnRMb2NhdGlvbi54ICsgMSArIDEwICogY3VycmVudExvY2F0aW9uLnkpID09IC0xKSB7XG4gICAgICAgICAgcXVldWUucHVzaCh7eCA6IDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnl9KTtcbiAgICAgIH1cbiAgICAgIGlmICgobWFwLmdldFRpbGUoMSAqIGN1cnJlbnRMb2NhdGlvbi54LCAxICogY3VycmVudExvY2F0aW9uLnkgLSAxKS53YWxrYWJsZSkgJiYgY2hlY2tlZC5pbmRleE9mKDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEwICogKDEgKiBjdXJyZW50TG9jYXRpb24ueSAtIDEpKSA9PSAtMSkge1xuICAgICAgICAgIHF1ZXVlLnB1c2goe3ggOiAxICogY3VycmVudExvY2F0aW9uLngsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnkgLSAxfSk7XG4gICAgICB9XG4gICAgICBpZiAoKG1hcC5nZXRUaWxlKDEgKiBjdXJyZW50TG9jYXRpb24ueCwgMSAqIGN1cnJlbnRMb2NhdGlvbi55ICsgMSkud2Fsa2FibGUpICYmIGNoZWNrZWQuaW5kZXhPZigxICogY3VycmVudExvY2F0aW9uLnggKyAxMCAqICgxICogY3VycmVudExvY2F0aW9uLnkgKyAxKSkgPT0gLTEpIHtcbiAgICAgICAgICBxdWV1ZS5wdXNoKHt4IDogMSAqIGN1cnJlbnRMb2NhdGlvbi54LCB5IDogMSAqIGN1cnJlbnRMb2NhdGlvbi55ICsgMX0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gaW5pdF9tYXA7XG59KHdpbmRvdywgJ2R1bmdlb24nKTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIG1ha2VEdW5nZW9uKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
