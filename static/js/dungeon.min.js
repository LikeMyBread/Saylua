function init(){getMap(),setButton()}function getMap(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var t=JSON.parse(e.responseText);map.tiles=t.map,fillMap(map),addPlayer(t.player.x,t.player.y)}},e.open("GET","api/dungeon",!0),e.send()}function getMask(e,t){var a=0,n=2*(map.getTile(e,t-1)||0),y=8*(map.getTile(e-1,t)||0),l=16*(map.getTile(e+1,t)||0),i=64*(map.getTile(e,t+1)||0);a+=n+y+l+i,n>0&&y>0&&(a+=map.getTile(e-1,t-1)||0),n>0&&l>0&&(a+=4*(map.getTile(e+1,t-1)||0)),i>0&&y>0&&(a+=32*(map.getTile(e-1,t+1)||0)),i>0&&l>0&&(a+=128*(map.getTile(e+1,t+1)||0));var o={2:1,8:2,10:3,11:4,16:5,18:6,22:7,24:8,26:9,27:10,30:11,31:12,64:13,66:14,72:15,74:16,75:17,80:18,82:19,86:20,88:21,90:22,91:23,94:24,95:25,104:26,106:27,107:28,120:29,122:30,123:31,126:32,127:33,208:34,210:35,214:36,216:37,218:38,219:39,222:40,223:41,248:42,250:43,251:44,254:45,255:46,0:47};return o[a+""]}function fillMap(e){dungeon=document.getElementById("dungeon"),dungeon.style.width="640px",dungeon.style.height="512px";for(var t=document.createDocumentFragment(),a=0;T_COUNTY>a;a++)for(var n=0;T_COUNTX>n;n++){var y=document.createElement("div");y.id=n+"_"+a,y.className="dungeonTile",y.style.width="64px",y.style.height="64px",e.getTile(n,a)>0&&(y.style.backgroundImage="url('static/img/tiles/"+getMask(n,a)+".png')"),y.addEventListener("click",findPath),y.dataset.x=n,y.dataset.y=a,t.appendChild(y)}dungeon.appendChild(t)}function addPlayer(e,t){dungeon=document.getElementById("dungeon");var a=document.createElement("div");a.id="player",a.className="dungeonObject",a.style.width="64px",a.style.height="64px",a.style.backgroundImage="url('static/img/SHC.png')",a.style.backgroundSize="64px 64px ",dungeon.appendChild(a),movePlayer(e,t)}function movePlayer(e,t){var a=document.getElementById("player");1==map.getTile(player.x+e,player.y+t)&&(player.x+=e,player.y+=t,a.style.left=player.x*T_WIDTH+"px",a.style.top=player.y*T_WIDTH-PLAYER_OFFSET+"px")}function checkKey(e){e=e||window.event,"38"==e.keyCode||"87"==e.keyCode?movePlayer(0,-1):"40"==e.keyCode||"83"==e.keyCode?movePlayer(0,1):"37"==e.keyCode||"65"==e.keyCode?movePlayer(-1,0):"39"!=e.keyCode&&"68"!=e.keyCode||movePlayer(1,0)}function moveHere(){Math.abs(this.dataset.x-player.x)>Math.abs(this.dataset.y-player.y)?this.dataset.x-player.x>0?movePlayer(1,0):movePlayer(-1,0):this.dataset.y-player.y>0?movePlayer(0,1):movePlayer(0,-1)}function findPath(){if(player.x!=this.dataset.x||player.y!=this.dataset.y)for(var e=[{x:this.dataset.x,y:this.dataset.y}],t=[];e.length>0;){var a=e.shift();if(t.push(1*a.x+10*a.y),player.x==a.x-1&&player.y==a.y)return void movePlayer(1,0);if(player.x==1*a.x+1&&player.y==a.y)return void movePlayer(-1,0);if(player.x==1*a.x&&player.y==a.y-1)return void movePlayer(0,1);if(player.x==1*a.x&&player.y==1*a.y+1)return void movePlayer(0,-1);0!=map.getTile(1*a.x-1,1*a.y)&&-1==t.indexOf(1*a.x-1+10*a.y)&&e.push({x:1*a.x-1,y:1*a.y}),0!=map.getTile(1*a.x+1,1*a.y)&&-1==t.indexOf(1*a.x+1+10*a.y)&&e.push({x:1*a.x+1,y:1*a.y}),0!=map.getTile(1*a.x,1*a.y-1)&&-1==t.indexOf(1*a.x+10*(1*a.y-1))&&e.push({x:1*a.x,y:1*a.y-1}),0!=map.getTile(1*a.x,1*a.y+1)&&-1==t.indexOf(1*a.x+10*(1*a.y+1))&&e.push({x:1*a.x,y:1*a.y+1})}}function setButton(){tButton=document.getElementById("tButton"),tButton.onclick=demoAjax}window.addEventListener("load",init);const T_WIDTH=64,T_COUNTX=10,T_COUNTY=8,TILE_LOC="static/img/tiles/",PLAYER_OFFSET=20;var map={cols:T_COUNTX,rows:T_COUNTY,tsize:T_WIDTH,tiles:[1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,1,0,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,1,1,0,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,1],getTile:function(e,t){return e>map.cols-1||t>map.rows-1||0>t||0>e?0:this.tiles[t*map.cols+e]}},player={x:0,y:0};window.addEventListener("keydown",function(e){document.activeElement&&document.activeElement!=document.body||([37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),checkKey())},!1);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR1bmdlb24uanMiXSwibmFtZXMiOlsiaW5pdCIsImdldE1hcCIsInNldEJ1dHRvbiIsInhodHRwIiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwianNvbkRhdGEiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJtYXAiLCJ0aWxlcyIsImZpbGxNYXAiLCJhZGRQbGF5ZXIiLCJwbGF5ZXIiLCJ4IiwieSIsIm9wZW4iLCJzZW5kIiwiZ2V0TWFzayIsInRvdGFsIiwibm9ydGgiLCJnZXRUaWxlIiwid2VzdCIsImVhc3QiLCJzb3V0aCIsImNvbnZlcnRlciIsIjIiLCI4IiwiMTAiLCIxMSIsIjE2IiwiMTgiLCIyMiIsIjI0IiwiMjYiLCIyNyIsIjMwIiwiMzEiLCI2NCIsIjY2IiwiNzIiLCI3NCIsIjc1IiwiODAiLCI4MiIsIjg2IiwiODgiLCI5MCIsIjkxIiwiOTQiLCI5NSIsIjEwNCIsIjEwNiIsIjEwNyIsIjEyMCIsIjEyMiIsIjEyMyIsIjEyNiIsIjEyNyIsIjIwOCIsIjIxMCIsIjIxNCIsIjIxNiIsIjIxOCIsIjIxOSIsIjIyMiIsIjIyMyIsIjI0OCIsIjI1MCIsIjI1MSIsIjI1NCIsIjI1NSIsIjAiLCJkdW5nZW9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwid2lkdGgiLCJoZWlnaHQiLCJ0b0FkZCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJpIiwiVF9DT1VOVFkiLCJqIiwiVF9DT1VOVFgiLCJuZXdEaXYiLCJjcmVhdGVFbGVtZW50IiwiaWQiLCJjbGFzc05hbWUiLCJUX1dJRFRIIiwiYmFja2dyb3VuZEltYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbmRQYXRoIiwiZGF0YXNldCIsImFwcGVuZENoaWxkIiwicGxheWVyRGl2IiwiYmFja2dyb3VuZFNpemUiLCJtb3ZlUGxheWVyIiwibGVmdCIsInRvcCIsIlBMQVlFUl9PRkZTRVQiLCJjaGVja0tleSIsImUiLCJ3aW5kb3ciLCJldmVudCIsImtleUNvZGUiLCJtb3ZlSGVyZSIsIk1hdGgiLCJhYnMiLCJ0aGlzIiwicXVldWUiLCJjaGVja2VkIiwibGVuZ3RoIiwiY3VycmVudExvY2F0aW9uIiwic2hpZnQiLCJwdXNoIiwiaW5kZXhPZiIsInRCdXR0b24iLCJvbmNsaWNrIiwiZGVtb0FqYXgiLCJUSUxFX0xPQyIsImNvbHMiLCJyb3dzIiwidHNpemUiLCJjb2wiLCJyb3ciLCJhY3RpdmVFbGVtZW50IiwiYm9keSIsInByZXZlbnREZWZhdWx0Il0sIm1hcHBpbmdzIjoiQUFFQSxRQUFTQSxRQUNQQyxTQUNBQyxZQWdDRixRQUFTRCxVQUNQLEdBQUlFLEdBQVEsR0FBSUMsZUFDaEJELEdBQU1FLG1CQUFxQixXQUN6QixHQUF3QixHQUFwQkYsRUFBTUcsWUFBbUMsS0FBaEJILEVBQU1JLE9BQWUsQ0FDaEQsR0FBSUMsR0FBV0MsS0FBS0MsTUFBTVAsRUFBTVEsYUFDaENDLEtBQUlDLE1BQVFMLEVBQVNJLElBQ3JCRSxRQUFRRixLQUNSRyxVQUFVUCxFQUFTUSxPQUFPQyxFQUFHVCxFQUFTUSxPQUFPRSxLQUdqRGYsRUFBTWdCLEtBQUssTUFBTyxlQUFlLEdBQ2pDaEIsRUFBTWlCLE9BU1IsUUFBU0MsU0FBUUosRUFBR0MsR0FDbEIsR0FBSUksR0FBUSxFQUNSQyxFQUFTLEdBQUtYLElBQUlZLFFBQVFQLEVBQUdDLEVBQUksSUFBTSxHQUN2Q08sRUFBTyxHQUFLYixJQUFJWSxRQUFRUCxFQUFJLEVBQUdDLElBQU0sR0FDckNRLEVBQU8sSUFBTWQsSUFBSVksUUFBUVAsRUFBSSxFQUFHQyxJQUFNLEdBQ3RDUyxFQUFRLElBQU1mLElBQUlZLFFBQVFQLEVBQUdDLEVBQUksSUFBTSxFQUMzQ0ksSUFBU0MsRUFBUUUsRUFBT0MsRUFBT0MsRUFDM0JKLEVBQVEsR0FBS0UsRUFBTyxJQUN0QkgsR0FBVVYsSUFBSVksUUFBUVAsRUFBSSxFQUFHQyxFQUFJLElBQU0sR0FFckNLLEVBQVEsR0FBS0csRUFBTyxJ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T0csS0FrQm5DL0csUUFDRkMsRUFBRyxFQUNIQyxFQUFHLEVBMkVMd0YsUUFBT1osaUJBQWlCLFVBQVcsU0FBU1csR0FDcEM1QixTQUFTb0QsZUFBaUJwRCxTQUFTb0QsZUFBaUJwRCxTQUFTcUQsUUFJN0QsR0FBSSxHQUFJLEdBQUksSUFBSVgsUUFBUWQsRUFBRUcsU0FBVyxJQUNyQ0gsRUFBRTBCLGlCQUdOM0IsY0FDRCIsImZpbGUiOiJkdW5nZW9uLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBpbml0KTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgZ2V0TWFwKCk7XG4gIHNldEJ1dHRvbigpO1xufVxuXG5jb25zdCBUX1dJRFRIID0gNjQ7XG5jb25zdCBUX0NPVU5UWCA9IDEwO1xuY29uc3QgVF9DT1VOVFkgPSA4O1xuY29uc3QgVElMRV9MT0MgPSBcInN0YXRpYy9pbWcvdGlsZXMvXCJcbmNvbnN0IFBMQVlFUl9PRkZTRVQgPSAyMDtcblxuXG52YXIgbWFwID0ge1xuICBjb2xzOiBUX0NPVU5UWCxcbiAgcm93czogVF9DT1VOVFksXG4gIHRzaXplOiBUX1dJRFRILFxuICB0aWxlczogW1xuICAgIDEsIDEsIDAsIDAsIDAsIDEsIDEsIDEsIDEsIDEsXG4gICAgMSwgMSwgMSwgMSwgMSwgMCwgMCwgMSwgMCwgMSxcbiAgICAwLCAxLCAxLCAwLCAxLCAwLCAxLCAxLCAwLCAxLFxuICAgIDEsIDAsIDEsIDAsIDEsIDEsIDEsIDEsIDAsIDEsXG4gICAgMCwgMCwgMSwgMSwgMCwgMSwgMCwgMSwgMSwgMSxcbiAgICAwLCAxLCAxLCAxLCAxLCAxLCAxLCAwLCAwLCAxLFxuICAgIDEsIDEsIDEsIDAsIDAsIDEsIDEsIDAsIDAsIDEsXG4gICAgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMVxuICBdLFxuICBnZXRUaWxlOiBmdW5jdGlvbihjb2wsIHJvdykge1xuICAgIGlmIChjb2wgPiBtYXAuY29scyAtIDEgfHwgcm93ID4gbWFwLnJvd3MgLSAxIHx8IHJvdyA8IDAgfHwgY29sIDwgMCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnRpbGVzW3JvdyAqIG1hcC5jb2xzICsgY29sXTtcbiAgfVxufTtcblxuZnVuY3Rpb24gZ2V0TWFwICgpIHtcbiAgdmFyIHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHhodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh4aHR0cC5yZWFkeVN0YXRlID09IDQgJiYgeGh0dHAuc3RhdHVzID09IDIwMCkge1xuICAgICAgdmFyIGpzb25EYXRhID0gSlNPTi5wYXJzZSh4aHR0cC5yZXNwb25zZVRleHQpO1xuICAgICAgbWFwLnRpbGVzID0ganNvbkRhdGEubWFwO1xuICAgICAgZmlsbE1hcChtYXApO1xuICAgICAgYWRkUGxheWVyKGpzb25EYXRhLnBsYXllci54LCBqc29uRGF0YS5wbGF5ZXIueSk7XG4gICAgfVxuICB9O1xuICB4aHR0cC5vcGVuKFwiR0VUXCIsIFwiYXBpL2R1bmdlb25cIiwgdHJ1ZSk7XG4gIHhodHRwLnNlbmQoKTtcbn1cblxudmFyIHBsYXllciA9IHtcbiAgeDogMCxcbiAgeTogMFxufTtcblxuXG5mdW5jdGlvbiBnZXRNYXNrKHgsIHkpIHtcbiAgdmFyIHRvdGFsID0gMDtcbiAgdmFyIG5vcnRoID0gIDIgKiAobWFwLmdldFRpbGUoeCwgeSAtIDEpIHx8IDApO1xuICB2YXIgd2VzdCA9IDggKiAobWFwLmdldFRpbGUoeCAtIDEsIHkpIHx8IDApO1xuICB2YXIgZWFzdCA9IDE2ICogKG1hcC5nZXRUaWxlKHggKyAxLCB5KSB8fCAwKTtcbiAgdmFyIHNvdXRoID0gNjQgKiAobWFwLmdldFRpbGUoeCwgeSArIDEpIHx8IDApO1xuICB0b3RhbCArPSBub3J0aCArIHdlc3QgKyBlYXN0ICsgc291dGg7XG4gIGlmIChub3J0aCA+IDAgJiYgd2VzdCA+IDApIHtcbiAgICB0b3RhbCArPSAobWFwLmdldFRpbGUoeCAtIDEsIHkgLSAxKSB8fCAwKTtcbiAgfVxuICBpZiAobm9ydGggPiAwICYmIGVhc3QgPiAwKSB7XG4gICAgdG90YWwgKz0gNCAqIChtYXAuZ2V0VGlsZSh4ICsgMSwgeSAtIDEpIHx8IDApO1xuICB9XG4gIGlmIChzb3V0aCA+IDAgJiYgd2VzdCA+IDApIHtcbiAgICB0b3RhbCArPSAzMiAqIChtYXAuZ2V0VGlsZSh4IC0gMSwgeSArIDEpIHx8IDApO1xuICB9XG4gIGlmIChzb3V0aCA+IDAgJiYgZWFzdCA+IDApIHtcbiAgICB0b3RhbCArPSAxMjggKiAobWFwLmdldFRpbGUoeCArIDEsIHkgKyAxKSB8fCAwKTtcbiAgfVxuICB2YXIgY29udmVydGVyID0geyBcIjJcIiA6IDEsIFwiOFwiIDogMiwgXCIxMFwiIDogMywgXCIxMVwiIDogNCwgXCIxNlwiIDogNSwgXCIxOFwiIDogNiwgXCIyMlwiIDogNywgXCIyNFwiIDogOCwgXCIyNlwiIDogOSwgXCIyN1wiIDogMTAsIFwiMzBcIiA6IDExLCBcIjMxXCIgOiAxMiwgXCI2NFwiIDogMTMsIFwiNjZcIiA6IDE0LCBcIjcyXCIgOiAxNSwgXCI3NFwiIDogMTYsIFwiNzVcIiA6IDE3LCBcIjgwXCIgOiAxOCwgXCI4MlwiIDogMTksIFwiODZcIiA6IDIwLCBcIjg4XCIgOiAyMSwgXCI5MFwiIDogMjIsIFwiOTFcIiA6IDIzLCBcIjk0XCIgOiAyNCwgXCI5NVwiIDogMjUsIFwiMTA0XCIgOiAyNiwgXCIxMDZcIiA6IDI3LCBcIjEwN1wiIDogMjgsIFwiMTIwXCIgOiAyOSwgXCIxMjJcIiA6IDMwLCBcIjEyM1wiIDogMzEsIFwiMTI2XCIgOiAzMiwgXCIxMjdcIiA6IDMzLCBcIjIwOFwiIDogMzQsIFwiMjEwXCIgOiAzNSwgXCIyMTRcIiA6IDM2LCBcIjIxNlwiIDogMzcsIFwiMjE4XCIgOiAzOCwgXCIyMTlcIiA6IDM5LCBcIjIyMlwiIDogNDAsIFwiMjIzXCIgOiA0MSwgXCIyNDhcIiA6IDQyLCBcIjI1MFwiIDogNDMsIFwiMjUxXCIgOiA0NCwgXCIyNTRcIiA6IDQ1LCBcIjI1NVwiIDogNDYsIFwiMFwiIDogNDcgfTtcbiAgcmV0dXJuIGNvbnZlcnRlclt0b3RhbCArIFwiXCJdO1xufVxuXG5mdW5jdGlvbiBmaWxsTWFwKG1hcCkge1xuICBkdW5nZW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2R1bmdlb24nKTtcbiAgZHVuZ2Vvbi5zdHlsZS53aWR0aCA9IChUX1dJRFRIICogVF9DT1VOVFgpICsgXCJweFwiO1xuICBkdW5nZW9uLnN0eWxlLmhlaWdodCA9IChUX1dJRFRIICogVF9DT1VOVFkpICsgXCJweFwiO1xuXG4gIHZhciB0b0FkZCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBUX0NPVU5UWTsgaSsrKSB7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBUX0NPVU5UWDsgaisrKSB7XG4gICAgICAgdmFyIG5ld0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgIG5ld0Rpdi5pZCA9IGogKyBcIl9cIiArIGk7XG4gICAgICAgbmV3RGl2LmNsYXNzTmFtZSA9ICdkdW5nZW9uVGlsZSc7XG4gICAgICAgbmV3RGl2LnN0eWxlLndpZHRoID0gVF9XSURUSCArIFwicHhcIjtcbiAgICAgICBuZXdEaXYuc3R5bGUuaGVpZ2h0ID0gVF9XSURUSCArIFwicHhcIjtcbiAgICAgICBpZiAobWFwLmdldFRpbGUoaiwgaSkgPiAwKSB7XG4gICAgICAgICBuZXdEaXYuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoJ3N0YXRpYy9pbWcvdGlsZXMvXCIgKyBnZXRNYXNrKGosIGkpICsgXCIucG5nJylcIjtcbiAgICAgICB9XG4gICAgICAgbmV3RGl2LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmaW5kUGF0aCk7XG4gICAgICAgbmV3RGl2LmRhdGFzZXQueCA9IGo7XG4gICAgICAgbmV3RGl2LmRhdGFzZXQueSA9IGk7XG4gICAgICAgdG9BZGQuYXBwZW5kQ2hpbGQobmV3RGl2KTtcbiAgICB9XG4gIH1cbiAgZHVuZ2Vvbi5hcHBlbmRDaGlsZCh0b0FkZCk7XG59XG5cbmZ1bmN0aW9uIGFkZFBsYXllcih4LCB5KSB7XG4gIGR1bmdlb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHVuZ2VvbicpO1xuICB2YXIgcGxheWVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHBsYXllckRpdi5pZCA9ICdwbGF5ZXInO1xuICBwbGF5ZXJEaXYuY2xhc3NOYW1lID0gJ2R1bmdlb25PYmplY3QnO1xuICBwbGF5ZXJEaXYuc3R5bGUud2lkdGggPSBUX1dJRFRIICsgXCJweFwiO1xuICBwbGF5ZXJEaXYuc3R5bGUuaGVpZ2h0ID0gVF9XSURUSCArIFwicHhcIjtcbiAgcGxheWVyRGl2LnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKCdzdGF0aWMvaW1nL1NIQy5wbmcnKVwiO1xuICBwbGF5ZXJEaXYuc3R5bGUuYmFja2dyb3VuZFNpemUgPSAgVF9XSURUSCArIFwicHggXCIgKyBUX1dJRFRIICsgXCJweCBcIjtcbiAgZHVuZ2Vvbi5hcHBlbmRDaGlsZChwbGF5ZXJEaXYpO1xuICBtb3ZlUGxheWVyKHgsIHkpO1xufVxuXG5mdW5jdGlvbiBtb3ZlUGxheWVyKHgsIHkpIHtcbiAgdmFyIHBsYXllckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXInKTtcbiAgaWYgKG1hcC5nZXRUaWxlKHBsYXllci54ICsgeCwgcGxheWVyLnkgKyB5KSA9PSAxKSB7XG4gICAgcGxheWVyLnggKz0geDtcbiAgICBwbGF5ZXIueSArPSB5O1xuICAgIHBsYXllckRpdi5zdHlsZS5sZWZ0ID0gIChwbGF5ZXIueCAqIFRfV0lEVEgpICsgXCJweFwiO1xuICAgIHBsYXllckRpdi5zdHlsZS50b3AgPSAgKHBsYXllci55ICogVF9XSURUSCAtIFBMQVlFUl9PRkZTRVQpICsgXCJweFwiO1xuICB9XG59XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIHNwYWNlIGFuZCBhcnJvdyBrZXlzXG4gICAgaWYoWzM3LCAzOCwgMzksIDQwXS5pbmRleE9mKGUua2V5Q29kZSkgPiAtMSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgY2hlY2tLZXkoKTtcbn0sIGZhbHNlKTtcblxuZnVuY3Rpb24gY2hlY2tLZXkoZSkge1xuICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcblxuICAgIGlmIChlLmtleUNvZGUgPT0gJzM4JyB8fCBlLmtleUNvZGUgPT0gJzg3Jykge1xuICAgICAgLy8gdXAgYXJyb3dcbiAgICAgIG1vdmVQbGF5ZXIoMCwgLTEpO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09ICc0MCcgfHwgZS5rZXlDb2RlID09ICc4MycpIHtcbiAgICAgIC8vIGRvd24gYXJyb3dcbiAgICAgIG1vdmVQbGF5ZXIoMCwgMSk7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM3JyB8fCBlLmtleUNvZGUgPT0gJzY1Jykge1xuICAgICAgIC8vIGxlZnQgYXJyb3dcbiAgICAgICBtb3ZlUGxheWVyKC0xLCAwKTtcbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAnMzknIHx8IGUua2V5Q29kZSA9PSAnNjgnKSB7XG4gICAgICAgLy8gcmlnaHQgYXJyb3dcbiAgICAgICBtb3ZlUGxheWVyKDEsIDApO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbW92ZUhlcmUgKCkge1xuICBpZiAoTWF0aC5hYnModGhpcy5kYXRhc2V0LnggLSBwbGF5ZXIueCkgPiAgTWF0aC5hYnModGhpcy5kYXRhc2V0LnkgLSBwbGF5ZXIueSkpIHtcbiAgICBpZiAodGhpcy5kYXRhc2V0LnggLSBwbGF5ZXIueCA+IDApIHtcbiAgICAgIG1vdmVQbGF5ZXIoMSwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1vdmVQbGF5ZXIoLTEsIDApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAodGhpcy5kYXRhc2V0LnkgLSBwbGF5ZXIueSA+IDApIHtcbiAgICAgIG1vdmVQbGF5ZXIoMCwgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1vdmVQbGF5ZXIoMCwgLTEpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBmaW5kUGF0aCgpIHtcbiAgaWYgKHBsYXllci54ID09IHRoaXMuZGF0YXNldC54ICYmIHBsYXllci55ID09IHRoaXMuZGF0YXNldC55KSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBxdWV1ZSA9IFt7eCA6IHRoaXMuZGF0YXNldC54LCB5IDogdGhpcy5kYXRhc2V0Lnl9XTtcbiAgdmFyIGNoZWNrZWQgPSBbXTtcbiAgdmFyIGZvdW5kID0gZmFsc2U7XG4gIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgdmFyIGN1cnJlbnRMb2NhdGlvbiA9IHF1ZXVlLnNoaWZ0KCk7XG4gICAgY2hlY2tlZC5wdXNoKDEgKiBjdXJyZW50TG9jYXRpb24ueCArIDEwICogY3VycmVudExvY2F0aW9uLnkpO1xuICAgIGlmIChwbGF5ZXIueCA9PSBjdXJyZW50TG9jYXRpb24ueCAtIDEgJiYgcGxheWVyLnkgPT0gY3VycmVudExvY2F0aW9uLnkpIHtcbiAgICAgIG1vdmVQbGF5ZXIoMSwgMCk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChwbGF5ZXIueCA9PSAxICogY3VycmVudExvY2F0aW9uLnggKyAxICYmIHBsYXllci55ID09IGN1cnJlbnRMb2NhdGlvbi55KSB7XG4gICAgICBtb3ZlUGxheWVyKC0xLCAwKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKHBsYXllci54ID09IDEgKiBjdXJyZW50TG9jYXRpb24ueCAmJiBwbGF5ZXIueSA9PSBjdXJyZW50TG9jYXRpb24ueSAtIDEpIHtcbiAgICAgIG1vdmVQbGF5ZXIoMCwgMSk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChwbGF5ZXIueCA9PSAxICogY3VycmVudExvY2F0aW9uLnggJiYgcGxheWVyLnkgPT0gMSAqIGN1cnJlbnRMb2NhdGlvbi55ICsgMSkge1xuICAgICAgbW92ZVBsYXllcigwLCAtMSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgobWFwLmdldFRpbGUoMSAqIGN1cnJlbnRMb2NhdGlvbi54IC0gMSwgMSAqIGN1cnJlbnRMb2NhdGlvbi55KSAhPSAwKSAmJiBjaGVja2VkLmluZGV4T2YoMSAqIGN1cnJlbnRMb2NhdGlvbi54IC0gMSArIDEwICogY3VycmVudExvY2F0aW9uLnkpID09IC0xKSB7XG4gICAgICAgIHF1ZXVlLnB1c2goe3ggOiAxICogY3VycmVudExvY2F0aW9uLnggLSAxLCB5IDogMSAqIGN1cnJlbnRMb2NhdGlvbi55fSk7XG4gICAgfVxuICAgIGlmICgobWFwLmdldFRpbGUoMSAqIGN1cnJlbnRMb2NhdGlvbi54ICsgMSwgMSAqIGN1cnJlbnRMb2NhdGlvbi55KSAhPSAwKSAmJiBjaGVja2VkLmluZGV4T2YoMSAqIGN1cnJlbnRMb2NhdGlvbi54ICsgMSArIDEwICogY3VycmVudExvY2F0aW9uLnkpID09IC0xKSB7XG4gICAgICAgIHF1ZXVlLnB1c2goe3ggOiAxICogY3VycmVudExvY2F0aW9uLnggKyAxLCB5IDogMSAqIGN1cnJlbnRMb2NhdGlvbi55fSk7XG4gICAgfVxuICAgIGlmICgobWFwLmdldFRpbGUoMSAqIGN1cnJlbnRMb2NhdGlvbi54LCAxICogY3VycmVudExvY2F0aW9uLnkgLSAxKSAhPSAwKSAmJiBjaGVja2VkLmluZGV4T2YoMSAqIGN1cnJlbnRMb2NhdGlvbi54ICsgMTAgKiAoMSAqIGN1cnJlbnRMb2NhdGlvbi55IC0gMSkpID09IC0xKSB7XG4gICAgICAgIHF1ZXVlLnB1c2goe3ggOiAxICogY3VycmVudExvY2F0aW9uLngsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnkgLSAxfSk7XG4gICAgfVxuICAgIGlmICgobWFwLmdldFRpbGUoMSAqIGN1cnJlbnRMb2NhdGlvbi54LCAxICogY3VycmVudExvY2F0aW9uLnkgKyAxKSAhPSAwKSAmJiBjaGVja2VkLmluZGV4T2YoMSAqIGN1cnJlbnRMb2NhdGlvbi54ICsgMTAgKiAoMSAqIGN1cnJlbnRMb2NhdGlvbi55ICsgMSkpID09IC0xKSB7XG4gICAgICAgIHF1ZXVlLnB1c2goe3ggOiAxICogY3VycmVudExvY2F0aW9uLngsIHkgOiAxICogY3VycmVudExvY2F0aW9uLnkgKyAxfSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHNldEJ1dHRvbigpIHtcbiAgdEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidEJ1dHRvblwiKTtcbiAgdEJ1dHRvbi5vbmNsaWNrID0gZGVtb0FqYXg7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
